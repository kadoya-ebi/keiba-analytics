
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>コース特徴＋馬場メーター（JRA全10場）</title>
<style>
  :root{ --bg:#f7f7f9;--card:#fff;--border:#e5e7eb;--text:#111;--muted:#6b7280; --turf:#e6f4e6; --dirt:#f0e0d0; }
  body{margin:0;background:linear-gradient(#fafafa,#f3f4f6);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP","Hiragino Kaku Gothic ProN",Meiryo,sans-serif;color:var(--text)}
  .wrap{max-width:1000px;margin:0 auto;padding:16px 16px 96px}
  h1{font-size:20px;margin:0 0 12px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 4px 12px rgba(0,0,0,.04);padding:16px;margin:12px 0}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  select,button,input{padding:10px;border:1px solid var(--border);border-radius:12px;background:#fff;font:inherit}
  .feat{border-radius:16px;padding:16px;border:1px solid var(--border);background:var(--card)}
  .feat.turf{background:var(--turf)}
  .feat.dirt{background:var(--dirt)}
  .muted{color:var(--muted);font-size:12px}
  .big{font-size:18px;font-weight:700;margin-bottom:4px}
  .bar{position:relative;height:16px;border-radius:999px;overflow:hidden;border:1px solid var(--border);background:#f0f0f0}
  .bar .fill{position:absolute;top:0;left:0;bottom:0;background:linear-gradient(90deg,#a3e635,#facc15,#f97316,#ef4444)}
  .bar .tick{position:absolute;top:-6px;width:2px;height:28px;background:#999;opacity:.6}
  .legend{display:flex;justify-content:space-between;font-size:12px;color:#444;margin-top:6px}
  .mini{font-size:14px;padding:8px 10px;border-radius:10px;border:1px solid var(--border)}
</style>
</head>
<body>
<div class="wrap">
  <h1>コース特徴＋本日の馬場メーター（JRA全10場）</h1>

  <div class="card">
    <div class="row">
      <label>競馬場
        <select id="selTrack"></select>
      </label>
      <label>馬場
        <select id="selSurf">
          <option value="芝">芝</option>
          <option value="ダ">ダート</option>
        </select>
      </label>
      <label>距離
        <select id="selDist"></select>
      </label>
      <button id="btnCopy">テキストをコピー</button>
    </div>
    <div class="muted">※ 距離一覧は今後追加・修正可。坂高／高低差は目安を含みます。</div>
  </div>

  <div class="card feat" id="card">
    <div class="big" id="title">—</div>
    <div id="line1">—</div>
    <div id="line2" style="margin-top:4px">—</div>
    <div class="muted" id="meta" style="margin-top:8px">—</div>
  </div>

  <!-- 本日の馬場メーター -->
  <div class="card">
    <div class="row" style="justify-content:space-between;align-items:center">
      <strong>本日の馬場傾向（クッション値・含水率）</strong>
      <div class="row">
        <input id="inCv" type="number" step="0.1" placeholder="CV" class="mini" style="width:90px">
        <input id="inMo" type="number" step="0.1" placeholder="%水分" class="mini" style="width:100px">
        <button id="applyCond">反映</button>
        <button id="clearCond">クリア</button>
      </div>
    </div>
    <div style="margin-top:8px">
      <div class="row" style="gap:12px;align-items:center">
        <div style="min-width:100px;font-weight:600">芝クッション</div>
        <div class="bar" id="barCv" style="flex:1">
          <div class="fill" style="width:0%"></div>
          <div class="tick" style="left:0%"></div>
          <div class="tick" style="left:25%"></div>
          <div class="tick" style="left:50%"></div>
          <div class="tick" style="left:75%"></div>
          <div class="tick" style="left:100%"></div>
        </div>
        <div id="labCv" style="min-width:70px;text-align:right" class="muted">—</div>
      </div>
      <div class="legend"><span>柔らかめ</span><span>—</span><span>—</span><span>硬め</span></div>
    </div>
    <div style="margin-top:10px">
      <div class="row" style="gap:12px;align-items:center">
        <div style="min-width:100px;font-weight:600">含水率</div>
        <div class="bar" id="barMo" style="flex:1">
          <div class="fill" style="width:0%"></div>
          <div class="tick" style="left:0%"></div>
          <div class="tick" style="left:25%"></div>
          <div class="tick" style="left:50%"></div>
          <div class="tick" style="left:75%"></div>
          <div class="tick" style="left:100%"></div>
        </div>
        <div id="labMo" style="min-width:70px;text-align:right" class="muted">—</div>
      </div>
      <div class="legend"><span>良</span><span>稍重</span><span>重</span><span>不良</span></div>
    </div>
    <div class="muted" style="margin-top:6px">※ 目安：芝の含水率は 良≦10%、稍重≦15%、重≦20%。ダートは 良≦7%、稍重≦10%、重≦13% 目安。</div>
  </div>
</div>

<script>
const DATA = {"札幌": {"meta": {"turn": "右回り", "straight": 266, "elev": 0.7, "slope_h": 0.3, "shape": "標準"}, "芝": {"1200": {"note": "右回り・直線266m・ほぼ平坦（高低差0.7m）・小回り"}, "1500": {"note": "右回り・直線266m・平坦基調（高低差0.7m）・小回り"}, "1800": {"note": "右回り・直線266m・平坦基調（高低差0.7m）"}, "2000": {"note": "右回り・直線266m・平坦基調（高低差0.7m）"}, "2600": {"note": "右回り・直線266m・平坦基調（高低差0.7m）"}}, "ダ": {"1000": {"note": "右回り・直線264m相当・ほぼ平坦（高低差0.7m）"}, "1700": {"note": "右回り・直線264m相当・わずかに起伏（高低差0.7m）"}, "2400": {"note": "右回り・直線264m相当・わずかに起伏（高低差0.7m）"}}}, "函館": {"meta": {"turn": "右回り", "straight": 262, "elev": 3.4, "slope_h": 1.8, "shape": "小回り"}, "芝": {"1000": {"note": "右回り・直線262m・ゴール前坂あり（坂高1.8m／高低差3.4m）・小回り"}, "1200": {"note": "右回り・直線262m・坂あり（坂高1.8m／高低差3.4m）・小回り"}, "1800": {"note": "右回り・直線262m・坂あり（坂高1.8m／高低差3.4m）"}, "2000": {"note": "右回り・直線262m・坂あり（坂高1.8m／高低差3.4m）"}}, "ダ": {"1000": {"note": "右回り・直線260m・坂あり（坂高1.8m／高低差3.4m）"}, "1700": {"note": "右回り・直線260m・坂あり（坂高1.8m／高低差3.4m）"}}}, "福島": {"meta": {"turn": "右回り", "straight": 292, "elev": 1.9, "slope_h": 1.0, "shape": "小回り"}, "芝": {"1000": {"note": "右回り・直線292m・坂あり（坂高1.0m／高低差1.9m）・小回り"}, "1200": {"note": "右回り・直線292m・坂あり（坂高1.0m／高低差1.9m）・小回り"}, "1800": {"note": "右回り・直線292m・坂あり（坂高1.0m／高低差1.9m）"}, "2000": {"note": "右回り・直線292m・坂あり（坂高1.0m／高低差1.9m）"}}, "ダ": {"1150": {"note": "右回り・直線295m・坂あり（坂高1.0m／高低差1.9m）"}, "1700": {"note": "右回り・直線295m・坂あり（坂高1.0m／高低差1.9m）"}, "2400": {"note": "右回り・直線295m・坂あり（坂高1.0m／高低差1.9m）"}}}, "新潟": {"meta": {"turn": "左回り", "straight": 659, "elev": 0.0, "slope_h": 0.0, "shape": "大回り・直線長"}, "芝": {"1000": {"note": "直線コース（外回り相当）・坂なし・直線659m・平坦"}, "1200": {"note": "左回り・直線659m・坂なし・外回り"}, "1400": {"note": "左回り・直線659m・坂なし・外回り"}, "1600": {"note": "左回り・直線659m・坂なし・外回り"}, "1800": {"note": "左回り・直線659m・坂なし"}, "2000": {"note": "左回り・直線659m・坂なし"}, "2200": {"note": "左回り・直線659m・坂なし"}}, "ダ": {"1200": {"note": "左回り・直線353m・坂なし・平坦"}, "1800": {"note": "左回り・直線353m・坂なし・平坦"}, "2500": {"note": "左回り・直線353m・坂なし・平坦"}}}, "東京": {"meta": {"turn": "左回り", "straight": 526, "elev": 2.0, "slope_h": 1.5, "shape": "大回り"}, "芝": {"1400": {"note": "左回り・直線526m・ゴール前坂あり（坂高1.5m／高低差2.0m）・外回り"}, "1600": {"note": "左回り・直線526m・ゴール前坂あり（坂高1.5m／高低差2.0m）・外回り"}, "1800": {"note": "左回り・直線526m・ゴール前坂あり（坂高1.5m／高低差2.0m）"}, "2000": {"note": "左回り・直線526m・ゴール前坂あり（坂高1.5m／高低差2.0m）・2コーナー発走"}, "2400": {"note": "左回り・直線526m・ゴール前坂あり（坂高1.5m／高低差2.0m）"}, "2500": {"note": "左回り・直線526m・ゴール前坂あり（坂高1.5m／高低差2.0m）"}, "3400": {"note": "左回り・直線526m・ゴール前坂あり（坂高1.5m／高低差2.0m）"}}, "ダ": {"1300": {"note": "左回り・直線501m・ゴール前坂あり（坂高1.5m／高低差2.0m）"}, "1400": {"note": "左回り・直線501m・ゴール前坂あり（坂高1.5m／高低差2.0m）"}, "1600": {"note": "左回り・直線501m・ゴール前坂あり（坂高1.5m／高低差2.0m）・芝スタート", "turf_start": true}, "2100": {"note": "左回り・直線501m・ゴール前坂あり（坂高1.5m／高低差2.0m）"}}}, "中山": {"meta": {"turn": "右回り", "straight": 310, "elev": 5.3, "slope_h": 2.4, "shape": "小回り"}, "芝": {"1200": {"note": "右回り・直線310m・急坂あり（坂高2.4m／高低差5.3m）・小回り"}, "1600": {"note": "右回り・直線310m・急坂あり（坂高2.4m／高低差5.3m）・外回り"}, "1800": {"note": "右回り・直線310m・急坂あり（坂高2.4m／高低差5.3m）"}, "2000": {"note": "右回り・直線310m・急坂あり（坂高2.4m／高低差5.3m）・内回り"}, "2200": {"note": "右回り・直線310m・急坂あり（坂高2.4m／高低差5.3m）"}, "2500": {"note": "右回り・直線310m・急坂あり（坂高2.4m／高低差5.3m）"}}, "ダ": {"1200": {"note": "右回り・直線308m・急坂あり（坂高2.4m／高低差5.3m）"}, "1800": {"note": "右回り・直線308m・急坂あり（坂高2.4m／高低差5.3m）"}}}, "中京": {"meta": {"turn": "左回り", "straight": 412, "elev": 3.5, "slope_h": 2.0, "shape": "標準"}, "芝": {"1200": {"note": "左回り・直線412m・ゴール前坂あり（坂高2.0m／高低差3.5m）"}, "1400": {"note": "左回り・直線412m・坂あり（坂高2.0m／高低差3.5m）"}, "1600": {"note": "左回り・直線412m・坂あり（坂高2.0m／高低差3.5m）"}, "2000": {"note": "左回り・直線412m・坂あり（坂高2.0m／高低差3.5m）"}, "2200": {"note": "左回り・直線412m・坂あり（坂高2.0m／高低差3.5m）"}}, "ダ": {"1200": {"note": "左回り・直線375m・坂あり（坂高2.0m／高低差3.5m）"}, "1400": {"note": "左回り・直線375m・坂あり（坂高2.0m／高低差3.5m）・芝スタート", "turf_start": true}, "1800": {"note": "左回り・直線375m・坂あり（坂高2.0m／高低差3.5m）"}, "1900": {"note": "左回り・直線375m・坂あり（坂高2.0m／高低差3.5m）"}}}, "京都": {"meta": {"turn": "右回り", "straight": 404, "elev": 4.3, "slope_h": 2.0, "shape": "内外あり"}, "芝": {"1200": {"note": "右回り・直線404m・ゴール前坂あり（坂高2.0m／高低差4.3m）・内回り"}, "1400": {"note": "右回り・直線404m・ゴール前坂あり（坂高2.0m／高低差4.3m）・内回り"}, "1600": {"note": "右回り・直線404m・坂あり（坂高2.0m／高低差4.3m）・外回り"}, "1800": {"note": "右回り・直線404m・坂あり（坂高2.0m／高低差4.3m）・外回り"}, "2000": {"note": "右回り・直線404m・坂あり（坂高2.0m／高低差4.3m）・内回り"}, "2200": {"note": "右回り・直線328m・坂あり（坂高2.0m／高低差4.3m）・内回り"}, "2400": {"note": "右回り・直線404m・坂あり（坂高2.0m／高低差4.3m）・外回り"}, "3000": {"note": "右回り・直線404m・坂あり（坂高2.0m／高低差4.3m）・内回り"}, "3200": {"note": "右回り・直線404m・坂あり（坂高2.0m／高低差4.3m）・外回り"}}, "ダ": {"1200": {"note": "右回り・直線329m・概ね平坦（高低差2.0m）"}, "1400": {"note": "右回り・直線329m・概ね平坦（高低差2.0m）"}, "1800": {"note": "右回り・直線329m・坂あり（目安 坂高1.0m／高低差2.0m）"}, "1900": {"note": "右回り・直線329m・坂あり（目安 坂高1.0m／高低差2.0m）"}}}, "阪神": {"meta": {"turn": "右回り", "straight": 473, "elev": 1.8, "slope_h": 1.2, "shape": "外回りあり"}, "芝": {"1200": {"note": "右回り・直線356m（内回り）・坂あり（坂高1.2m／高低差1.8m）"}, "1400": {"note": "右回り・直線473m（外回り）・坂あり（坂高1.2m／高低差1.8m）"}, "1600": {"note": "右回り・外回り・直線473m・坂あり（坂高1.2m／高低差1.8m）"}, "1800": {"note": "右回り・外回り・直線473m・坂あり（坂高1.2m／高低差1.8m）"}, "2000": {"note": "右回り・内回り・直線356m・坂あり（坂高1.2m／高低差1.8m）"}, "2200": {"note": "右回り・外回り・直線473m・坂あり（坂高1.2m／高低差1.8m）"}, "2400": {"note": "右回り・外回り・直線473m・坂あり（坂高1.2m／高低差1.8m）"}}, "ダ": {"1200": {"note": "右回り・直線352m・坂あり（坂高1.2m／高低差1.8m）"}, "1400": {"note": "右回り・直線352m・坂あり（坂高1.2m／高低差1.8m）"}, "1800": {"note": "右回り・直線352m・坂あり（坂高1.2m／高低差1.8m）・芝スタートの番組あり", "turf_start": true}, "2000": {"note": "右回り・直線352m・坂あり（坂高1.2m／高低差1.8m）"}}}, "小倉": {"meta": {"turn": "右回り", "straight": 293, "elev": 2.8, "slope_h": 1.0, "shape": "小回り"}, "芝": {"1200": {"note": "右回り・直線293m・坂なし〜緩やか（高低差2.8m）・小回り"}, "1700": {"note": "右回り・直線293m・小回り・起伏あり（高低差2.8m）"}, "1800": {"note": "右回り・直線293m・起伏あり（高低差2.8m）"}, "2000": {"note": "右回り・直線293m・起伏あり（高低差2.8m）"}}, "ダ": {"1000": {"note": "右回り・直線291m・平坦寄り（高低差2.8m）"}, "1700": {"note": "右回り・直線291m・やや起伏（高低差2.8m）"}, "2400": {"note": "右回り・直線291m・やや起伏（高低差2.8m）"}}}};
const COND_LS = "keiba_today_condition_full_v1";

const $ = (q, el=document)=> el.querySelector(q);
const selT = $("#selTrack");
const selS = $("#selSurf");
const selD = $("#selDist");
const title = $("#title");
const line1 = $("#line1");
const line2 = $("#line2");
const meta = $("#meta");
const card = $("#card");
const inCv = $("#inCv");
const inMo = $("#inMo");

function loadCond(){ try{ return JSON.parse(localStorage.getItem(COND_LS))||{} }catch(e){ return {} } }
function saveCond(obj){ localStorage.setItem(COND_LS, JSON.stringify(obj)); }

function init(){
  Object.keys(DATA).forEach(t=>{
    const o=document.createElement('option'); o.value=t; o.textContent=t; selT.appendChild(o);
  });
  selT.onchange = onChangeSel;
  selS.onchange = onChangeSel;
  selD.onchange = render;
  document.getElementById("btnCopy").onclick = copyText;
  document.getElementById("applyCond").onclick = applyCond;
  document.getElementById("clearCond").onclick = clearCond;
  selT.value = "東京";
  selS.value = "芝";
  refreshDists();
  restoreCond();
}

function onChangeSel(){
  refreshDists();
  restoreCond();
}

function refreshDists(){
  selD.innerHTML="";
  const t = selT.value, s = selS.value;
  const dists = Object.keys(DATA[t][s]).sort((a,b)=>Number(a)-Number(b));
  dists.forEach(d=>{ const o=document.createElement('option'); o.value=d; o.textContent=d; selD.appendChild(o); });
  render();
}

function render(){
  const t=selT.value, s=selS.value, d=selD.value;
  const metaInfo = DATA[t].meta;
  const rec = DATA[t][s][d];
  title.textContent = `${t}・${s}・${d}m`;
  const turn = metaInfo.turn, straight = metaInfo.straight, elev = metaInfo.elev, slope_h = metaInfo.slope_h, shape = metaInfo.shape;
  card.classList.remove('turf','dirt');
  if (s==="芝") card.classList.add('turf'); else card.classList.add('dirt');
  line1.textContent = rec?.note || "（準備中）";
  line2.textContent = s==="ダ" && rec?.turf_start ? "芝スタート距離です。" : "";
  meta.textContent = `基本情報：${turn}／直線${straight}m／高低差${elev}m／坂高${slope_h}m／形状${shape}`;
}

function setBar(barId, labelId, value, min, max, formatter){
  const pct = Math.max(0, Math.min(100, (value-min) * 100 / (max-min)));
  const bar = document.getElementById(barId).querySelector(".fill");
  bar.style.width = isFinite(pct)? (pct + "%") : "0%";
  document.getElementById(labelId).textContent = formatter(value);
}

function labelMoist(val, surface){
  if (!isFinite(val)) return "—";
  const t = surface==="芝" ? [10,15,20] : [7,10,13];
  const lab = (val<=t[0]?"良": val<=t[1]?"稍重": val<=t[2]?"重":"不良");
  return `${lab} ${val.toFixed(1)}%`;
}
function labelCv(val){ return isFinite(val)? ("CV " + val.toFixed(1)) : "—"; }

function updateBars(){
  const t=selT.value, s=selS.value;
  const key = t + "|" + s;
  const cond = loadCond()[key];
  if (cond && isFinite(cond.cushion)){
    setBar("barCv", "labCv", cond.cushion, 7.0, 11.5, labelCv);
  }else{
    setBar("barCv", "labCv", 0, 7.0, 11.5, ()=>"—");
  }
  if (cond && isFinite(cond.moisture)){
    setBar("barMo", "labMo", cond.moisture, 0, 25, v=> labelMoist(v, s));
  }else{
    setBar("barMo", "labMo", 0, 25, v=> "—");
  }
  inCv.value = cond?.cushion ?? "";
  inMo.value = cond?.moisture ?? "";
}

function applyCond(){
  const t=selT.value, s=selS.value;
  const key = t + "|" + s;
  const cv = Number(inCv.value);
  const mo = Number(inMo.value);
  const store = loadCond();
  store[key] = { cushion: isFinite(cv)?cv:undefined, moisture: isFinite(mo)?mo:undefined, date: new Date().toISOString().slice(0,10) };
  saveCond(store);
  updateBars();
}

function clearCond(){
  const t=selT.value, s=selS.value;
  const key = t + "|" + s;
  const store = loadCond();
  delete store[key];
  saveCond(store);
  updateBars();
  inCv.value=""; inMo.value="";
}

function restoreCond(){
  updateBars();
}

async function copyText(){
  const t=selT.value, s=selS.value;
  const key = t + "|" + s;
  const cond = loadCond()[key];
  const todayLine = cond? `\n[本日の馬場] CV ${cond.cushion ?? "—"} / 含水 ${cond.moisture ?? "—"}%` : "";
  const text = `${title.textContent}\n${line1.textContent}\n${line2.textContent? line2.textContent+"\n":""}${meta.textContent}${todayLine}`;
  try{ await navigator.clipboard.writeText(text); alert("コピーしました"); }catch(e){ alert("コピーできませんでした"); }
}

init();
</script>
</body>
</html>
