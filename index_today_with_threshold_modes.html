
<!DOCTYPE html>
<html lang="ja"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>本日だけ使う版：目安切り替えつき</title>
<style>
  :root{ --bg:#f7f7f9;--card:#fff;--border:#e5e7eb;--text:#111;--muted:#6b7280; --turf:#e6f4e6; --dirt:#f0e0d0; }
  body{margin:0;background:linear-gradient(#fafafa,#f3f4f6);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP","Hiragino Kaku Gothic ProN",Meiryo,sans-serif;color:var(--text)}
  .wrap{max-width:980px;margin:0 auto;padding:16px 16px 80px}
  h1{font-size:20px;margin:0 0 12px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 4px 12px rgba(0,0,0,.04);padding:16px;margin:12px 0}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  select,button,input{padding:10px;border:1px solid var(--border);border-radius:12px;background:#fff;font:inherit}
  .feat{border-radius:16px;padding:16px;border:1px solid var(--border);background:var(--card)}
  .feat.turf{background:var(--turf)} .feat.dirt{background:var(--dirt)}
  .muted{color:var(--muted);font-size:12px}
  .big{font-size:18px;font-weight:700;margin-bottom:4px}
  .bar{position:relative;height:16px;border-radius:999px;overflow:hidden;border:1px solid var(--border);background:#f0f0f0}
  .bar .fill{position:absolute;top:0;left:0;bottom:0;background:linear-gradient(90deg,#a3e635,#facc15,#f97316,#ef4444)}
  .bar .tick{position:absolute;top:-6px;width:2px;height:28px;background:#999;opacity:.6}
  .legend{display:flex;justify-content:space-between;font-size:12px;color:#444;margin-top:6px}
  .mini{font-size:14px;padding:8px 10px;border-radius:10px;border:1px solid var(--border)}
  .thbox{display:flex;gap:6px;align-items:center}
  .thbox input{width:80px}
</style>
</head>
<body>
<div class="wrap">
  <h1>本日だけ使う版：コース特徴＋馬場メーター <small class="muted">（目安：自動/芝固定/ダート固定/カスタム）</small></h1>

  <div class="card">
    <div class="row">
      <label>競馬場 <select id="selTrack"></select></label>
      <label>馬場 <select id="selSurf"><option value="芝">芝</option><option value="ダ">ダート</option></select></label>
      <label>距離 <select id="selDist"></select></label>
      <button id="btnCopy">テキストをコピー</button>
    </div>
    <div class="muted">※ 保存・履歴・シート連携なし。ページを閉じるとリセット。</div>
  </div>

  <div class="card feat" id="card">
    <div class="big" id="title">—</div>
    <div id="line1">—</div>
    <div id="line2" style="margin-top:4px">—</div>
    <div class="muted" id="meta" style="margin-top:8px">—</div>
  </div>

  <div class="card">
    <div class="row" style="justify-content:space-between;align-items:center">
      <strong>本日の馬場傾向（クッション値・含水率）</strong>
      <div class="row">
        <input id="inCv" type="number" step="0.1" placeholder="CV" class="mini" style="width:90px">
        <input id="inMo" type="number" step="0.1" placeholder="%水分" class="mini" style="width:100px">
        <button id="applyCond">反映</button>
        <button id="clearCond">クリア</button>
      </div>
    </div>

    <div class="row" style="margin-top:8px;align-items:center;gap:12px">
      <div class="thbox">
        <label>目安モード
          <select id="selMode" class="mini">
            <option value="auto">自動（馬場に合わせる）</option>
            <option value="turf">芝で固定</option>
            <option value="dirt">ダートで固定</option>
            <option value="custom">カスタム</option>
          </select>
        </label>
      </div>
      <div id="customBox" class="thbox" style="display:none">
        <span class="muted">カスタム閾値：</span>
        <label>良≦ <input id="th1" type="number" step="0.1" value="10"></label>
        <label>稍重≦ <input id="th2" type="number" step="0.1" value="15"></label>
        <label>重≦ <input id="th3" type="number" step="0.1" value="20"></label>
        <button id="applyTh" class="mini">反映</button>
      </div>
    </div>

    <div style="margin-top:8px">
      <div class="row" style="gap:12px;align-items:center">
        <div style="min-width:100px;font-weight:600">芝クッション</div>
        <div class="bar" id="barCv" style="flex:1">
          <div class="fill" style="width:0%"></div>
          <div class="tick" style="left:0%"></div>
          <div class="tick" style="left:25%"></div>
          <div class="tick" style="left:50%"></div>
          <div class="tick" style="left:75%"></div>
          <div class="tick" style="left:100%"></div>
        </div>
        <div id="labCv" style="min-width:90px;text-align:right" class="muted">—</div>
      </div>
      <div class="legend"><span>柔らかめ</span><span>—</span><span>—</span><span>硬め</span></div>
    </div>
    <div style="margin-top:10px">
      <div class="row" style="gap:12px;align-items:center">
        <div style="min-width:100px;font-weight:600">含水率</div>
        <div class="bar" id="barMo" style="flex:1">
          <div class="fill" style="width:0%"></div>
          <div class="tick" style="left:0%"></div>
          <div class="tick" style="left:25%"></div>
          <div class="tick" style="left:50%"></div>
          <div class="tick" style="left:75%"></div>
          <div class="tick" style="left:100%"></div>
        </div>
        <div id="labMo" style="min-width:90px;text-align:right" class="muted">—</div>
      </div>
      <div class="legend" id="legendMo"><span>良</span><span>稍重</span><span>重</span><span>不良</span></div>
    </div>
  </div>
</div>

<script>
const DATA = {"東京": {"meta": {"turn": "左回り", "straight": 526, "elev": 2.0, "slope_h": 1.5, "shape": "大回り"}, "芝": {"1600": {"note": "左回り・直線526m・ゴール前坂あり（坂高1.5m／高低差2.0m）・外回り"}, "2400": {"note": "左回り・直線526m・ゴール前坂あり（坂高1.5m／高低差2.0m）"}}, "ダ": {"1600": {"note": "左回り・直線501m・ゴール前坂あり・芝スタート", "turf_start": true}, "2100": {"note": "左回り・直線501m・ゴール前坂あり"}}}, "中山": {"meta": {"turn": "右回り", "straight": 310, "elev": 5.3, "slope_h": 2.4, "shape": "小回り"}, "芝": {"2000": {"note": "右回り・直線310m・急坂あり（坂高2.4m／高低差5.3m）・内回り"}}, "ダ": {"1800": {"note": "右回り・直線308m・急坂あり（坂高2.4m／高低差5.3m）"}}}, "京都": {"meta": {"turn": "右回り", "straight": 404, "elev": 4.3, "slope_h": 2.0, "shape": "内外あり"}, "芝": {"1600": {"note": "右回り・直線404m・坂あり（坂高2.0m／高低差4.3m）・外回り"}}, "ダ": {"1800": {"note": "右回り・直線329m・坂あり（目安 坂高1.0m／高低差2.0m）"}}}};
const $ = (q, el=document)=> el.querySelector(q);
const selT = $("#selTrack"), selS = $("#selSurf"), selD = $("#selDist");
const title = $("#title"), line1 = $("#line1"), line2 = $("#line2"), meta = $("#meta"), card = $("#card");
const inCv = $("#inCv"), inMo = $("#inMo");
const selMode = $("#selMode"), customBox = $("#customBox"), th1=$("#th1"), th2=$("#th2"), th3=$("#th3");

let thresholds = { turf:[10,15,20], dirt:[7,10,13], custom:[10,15,20] };
let mode = "auto";

function init(){
  Object.keys(DATA).forEach(t=>{
    const o=document.createElement('option'); o.value=t; o.textContent=t; selT.appendChild(o);
  });
  selT.value = "東京"; selS.value = "芝";
  selT.onchange = onChangeSel; selS.onchange = onChangeSel; selD.onchange = render;
  $("#btnCopy").onclick = copyText;
  $("#applyCond").onclick = applyCond;
  $("#clearCond").onclick = clearCond;
  selMode.onchange = onModeChange;
  $("#applyTh").onclick = ()=>{ thresholds.custom = [Number(th1.value)||10, Number(th2.value)||15, Number(th3.value)||20]; updateBars(); updateLegend(); };

  refreshDists(); render(); updateLegend();
}

function onModeChange(){
  mode = selMode.value;
  customBox.style.display = (mode==="custom") ? "flex" : "none";
  updateBars(); updateLegend();
}

function currentThreshold(){
  if (mode==="turf") return thresholds.turf;
  if (mode==="dirt") return thresholds.dirt;
  if (mode==="custom") return thresholds.custom;
  return (selS.value==="芝") ? thresholds.turf : thresholds.dirt;
}

function updateLegend(){
  const th = currentThreshold();
  const el = $("#legendMo");
  el.innerHTML = `<span>良（≦${th[0]}%）</span><span>稍重（≦${th[1]}%）</span><span>重（≦${th[2]}%）</span><span>不良（＞${th[2]}%）</span>`;
}

function onChangeSel(){ refreshDists(); render(); updateBars(); updateLegend(); }

function refreshDists(){
  selD.innerHTML="";
  const t = selT.value, s = selS.value;
  const dists = Object.keys(DATA[t][s]).sort((a,b)=>Number(a)-Number(b));
  dists.forEach(d=>{ const o=document.createElement('option'); o.value=d; o.textContent=d; selD.appendChild(o); });
}

function render(){
  const t=selT.value, s=selS.value, d=selD.value;
  const metaInfo = DATA[t].meta;
  const rec = DATA[t][s][d];
  title.textContent = `${t}・${s}・${d}m`;
  const turn = metaInfo.turn, straight = metaInfo.straight, elev = metaInfo.elev, slope_h = metaInfo.slope_h, shape = metaInfo.shape;
  card.classList.remove('turf','dirt'); card.classList.add(s==="芝" ? 'turf':'dirt');
  line1.textContent = rec?.note || "（準備中）";
  line2.textContent = s==="ダ" && rec?.turf_start ? "芝スタート距離です。" : "";
  meta.textContent = `基本情報：${turn}／直線${straight}m／高低差${elev}m／坂高${slope_h}m／形状${shape}`;
}

function setBar(barId, labelId, value, min, max, formatter){
  const pct = Math.max(0, Math.min(100, (value-min) * 100 / (max-min)));
  const bar = document.getElementById(barId).querySelector(".fill");
  bar.style.width = isFinite(pct)? (pct + "%") : "0%";
  document.getElementById(labelId).textContent = formatter(value);
}

function labelMoist(val){
  if (!isFinite(val)) return "—";
  const t = currentThreshold();
  const lab = (val<=t[0]?"良": val<=t[1]?"稍重": val<=t[2]?"重":"不良");
  return `${lab} ${val.toFixed(1)}%`;
}

function applyCond(){
  const cv = Number(inCv.value), mo = Number(inMo.value);
  if (isFinite(cv)){ window.__cv = cv; setBar("barCv","labCv", cv, 7.0, 11.5, v=> "CV " + v.toFixed(1)); }
  if (isFinite(mo)){ window.__mo = mo; setBar("barMo","labMo", mo, 0, 25, v=> labelMoist(mo)); }
}

function updateBars(){
  if (window.__cv != null) setBar("barCv","labCv", window.__cv, 7.0, 11.5, v=> "CV " + v.toFixed(1)); else setBar("barCv","labCv", 0, 7.0, 11.5, ()=>"—");
  if (window.__mo != null) setBar("barMo","labMo", window.__mo, 0, 25, v=> labelMoist(window.__mo)); else setBar("barMo","labMo", 0, 25, ()=>"—");
}

function clearCond(){
  window.__cv = undefined; window.__mo = undefined;
  setBar("barCv","labCv", 0, 7.0, 11.5, ()=>"—");
  setBar("barMo","labMo", 0, 25, ()=>"—");
  inCv.value=""; inMo.value="";
}

async function copyText(){
  const tLine = title.textContent;
  const l1 = line1.textContent;
  const l2 = line2.textContent ? line2.textContent + "\n" : "";
  const metaLine = meta.textContent;
  const today = `\n[本日の馬場] CV ${window.__cv ?? "—"} / 含水 ${window.__mo ?? "—"}% （目安: ${selMode.value}）`;
  const text = `${tLine}\n${l1}\n${l2}${metaLine}${today}`;
  try{ await navigator.clipboard.writeText(text); alert("コピーしました"); }catch(e){ alert("コピーできませんでした"); }
}

init();
</script>
</body></html>
