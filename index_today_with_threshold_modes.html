<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>JRAコース早見（本日だけ使う版）</title>
<style>
  :root{
    --bg:#f3f4f6;
    --card:#fff;
    --border:#e5e7eb;
    --text:#0f172a;
    --muted:#6b7280;
    --turf:#e9f7e6;
    --dirt:#f7ecdd;
    --accent:#0f766e;
  }

  /* 全体 */
  body{
    margin:0;
    background:linear-gradient(#f8fafc,#e2e8f0);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP","Hiragino Kaku Gothic ProN",Meiryo,sans-serif;
    color:var(--text);
  }
  .wrap{
    max-width:980px;
    margin:0 auto;
    padding:12px 14px 80px;
  }

  /* ヘッダー */
  .topbar{
    background:var(--accent);
    color:#fff;
    padding:10px 16px 12px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    border-radius:0 0 18px 18px;
    margin:-12px -14px 14px;
  }
  .topbar .logo{
    font-weight:700;
    letter-spacing:.04em;
  }
  .topbar .today{
    font-size:12px;
    opacity:.8;
  }

  /* カード共通 */
  .card{
    background:var(--card);
    border:1px solid rgba(15,118,110,.03);
    border-radius:16px;
    box-shadow:0 4px 14px rgba(15,23,42,.04);
    padding:14px 14px 14px;
    margin:10px 0;
  }

  /* 入力帯 */
  .selector-bar{
    background:#f3f4f6;
    border:1px solid #e2e8f0;
    border-radius:15px;
    padding:8px;
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    align-items:center;
  }
  .selector-bar label{
    font-size:11px;
    color:#475569;
    display:flex;
    flex-direction:column;
    gap:3px;
    min-width:110px;
  }
  select,button,input{
    padding:8px 9px;
    border:1px solid #d4d4d8;
    border-radius:12px;
    background:#fff;
    font:inherit;
  }
  button{
    cursor:pointer;
    background:#fff;
    transition:.15s;
  }
  button:hover{
    background:#e2e8f0;
  }
  .muted{
    color:var(--muted);
    font-size:12px;
  }

  /* コース特徴カード */
  .feat{
    border-radius:16px;
    border:1px solid rgba(15,118,110,.04);
    position:relative;
  }
  .feat.turf{ background:var(--turf); }
  .feat.dirt{ background:var(--dirt); }

  /* 小タグ */
  .tag{
    display:inline-block;
    padding:2px 10px 3px;
    border-radius:999px;
    font-size:11px;
    font-weight:600;
    margin-right:6px;
  }
  .tag.turf{background:#22c55e22;color:#166534;}
  .tag.dirt{background:#92400e22;color:#92400e;}

  .big{
    font-size:18px;
    font-weight:700;
    margin-bottom:2px;
  }

  /* コース情報を小カードで並べる */
  .course-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(118px,1fr));
    gap:8px;
    margin-top:10px;
  }
  .cg{
    background:rgba(255,255,255,.4);
    border:1px solid rgba(148,163,184,.3);
    border-radius:12px;
    padding:5px 8px 7px;
    font-size:11px;
    color:#334155;
  }
  .cg strong{
    display:block;
    font-size:14px;
    margin-top:1px;
    color:#0f172a;
  }

  /* 馬場メーター */
  .bar{
    position:relative;
    height:16px;
    border-radius:999px;
    overflow:hidden;
    border:1px solid #e2e8f0;
    background:#f8fafc;
  }
  .bar .fill{
    position:absolute;
    top:0;left:0;bottom:0;
    background:linear-gradient(90deg,#38bdf8,#22c55e,#f97316,#ef4444);
    width:0%;
  }
  .bar .tick{
    position:absolute;
    top:-6px;
    width:2px;
    height:28px;
    background:#94a3b8;
    opacity:.5;
  }
  .legend{
    display:flex;
    justify-content:space-between;
    font-size:11px;
    color:#475569;
    margin-top:4px;
  }

  /* 状態バッジ */
  .cond-badge{
    display:inline-block;
    padding:3px 10px 4px;
    border-radius:999px;
    font-size:11px;
    font-weight:600;
    margin-left:6px;
  }
  .cond-good{background:#dcfce7;color:#166534;}
  .cond-yayo{background:#fef9c3;color:#854d0e;}
  .cond-heavy{background:#fee4e2;color:#b91c1c;}

  /* 目安ボックス */
  .thbox{
    display:flex;
    gap:6px;
    align-items:center;
  }
  .mini{
    font-size:13px;
    padding:6px 8px;
    border-radius:10px;
    border:1px solid #e2e8f0;
  }

  /* スマホ対応 */
  @media (max-width:640px){
    .selector-bar{flex-direction:column;align-items:stretch;}
    .course-grid{grid-template-columns:repeat(auto-fit,minmax(140px,1fr));}
    .topbar{flex-direction:column;align-items:flex-start;gap:4px;}
  }
</style>
</head>
<body>
<header class="topbar">
  <div class="logo">JRAコース早見</div>
  <div class="today">本日入力版</div>
</header>

<div class="wrap">
  <!-- 入力 -->
  <div class="card">
    <div class="selector-bar">
      <label>競馬場
        <select id="selTrack"></select>
      </label>
      <label>馬場
        <select id="selSurf">
          <option value="芝">芝</option>
          <option value="ダ">ダート</option>
        </select>
      </label>
      <label>距離
        <select id="selDist"></select>
      </label>
      <button id="btnCopy">テキストをコピー</button>
    </div>
    <div class="muted" style="margin-top:6px">※ ページを閉じるとリセット。今日だけのメモ用。</div>
  </div>

  <!-- コース特徴 -->
  <div class="card feat turf" id="card">
    <div class="big" id="title">—</div>
    <div id="line1">—</div>
    <div id="line2" style="margin-top:4px">—</div>
    <div class="muted" id="meta" style="margin-top:8px">—</div>
    <div class="course-grid" id="courseGrid">
      <!-- JSで埋める -->
    </div>
  </div>

  <!-- 馬場傾向 -->
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
      <strong>本日の馬場傾向（クッション値・含水率）</strong>
      <div style="display:flex;gap:6px;flex-wrap:wrap">
        <input id="inCv" type="number" step="0.1" placeholder="CV" class="mini" style="width:90px">
        <input id="inMo" type="number" step="0.1" placeholder="%水分" class="mini" style="width:100px">
        <button id="applyCond" class="mini">反映</button>
        <button id="clearCond" class="mini">クリア</button>
      </div>
    </div>

    <div style="margin-top:8px;display:flex;gap:10px;flex-wrap:wrap;align-items:center">
      <label>目安モード
        <select id="selMode" class="mini">
          <option value="auto">自動（馬場に合わせる）</option>
          <option value="turf">芝で固定</option>
          <option value="dirt">ダートで固定</option>
          <option value="custom">カスタム</option>
        </select>
      </label>
      <div id="customBox" class="thbox" style="display:none">
        <span class="muted">カスタム閾値：</span>
        <label>良≦ <input id="th1" type="number" step="0.1" value="10" class="mini" style="width:70px"></label>
        <label>稍重≦ <input id="th2" type="number" step="0.1" value="15" class="mini" style="width:70px"></label>
        <label>重≦ <input id="th3" type="number" step="0.1" value="20" class="mini" style="width:70px"></label>
        <button id="applyTh" class="mini">反映</button>
      </div>
    </div>

    <!-- CV -->
    <div style="margin-top:10px">
      <div style="display:flex;gap:12px;align-items:center">
        <div style="min-width:100px;font-weight:600">芝クッション</div>
        <div class="bar" id="barCv" style="flex:1">
          <div class="fill" style="width:0%"></div>
          <div class="tick" style="left:0%"></div>
          <div class="tick" style="left:25%"></div>
          <div class="tick" style="left:50%"></div>
          <div class="tick" style="left:75%"></div>
          <div class="tick" style="left:100%"></div>
        </div>
        <div id="labCv" style="min-width:110px;text-align:right" class="muted">—</div>
      </div>
      <div class="legend"><span>柔らかめ</span><span>—</span><span>—</span><span>硬め</span></div>
    </div>

    <!-- 含水 -->
    <div style="margin-top:10px">
      <div style="display:flex;gap:12px;align-items:center">
        <div style="min-width:100px;font-weight:600">含水率</div>
        <div class="bar" id="barMo" style="flex:1">
          <div class="fill" style="width:0%"></div>
          <div class="tick" style="left:0%"></div>
          <div class="tick" style="left:25%"></div>
          <div class="tick" style="left:50%"></div>
          <div class="tick" style="left:75%"></div>
          <div class="tick" style="left:100%"></div>
        </div>
        <div id="labMo" style="min-width:130px;text-align:right" class="muted">—</div>
      </div>
      <div class="legend" id="legendMo"><span>良</span><span>稍重</span><span>重</span><span>不良</span></div>
    </div>
  </div>
</div>

<script>
/* ====== 1. JRA 全場データ ====== */
const DATA = {
  "札幌": {
    "meta": {"turn":"右回り","straight":266,"elev":0.7,"slope_h":0.3,"shape":"標準"},
    "芝": {
      "1200":{"note":"右回り・直線266m・ほぼ平坦（高低差0.7m）・小回り"},
      "1500":{"note":"右回り・直線266m・平坦基調（高低差0.7m）・小回り"},
      "1800":{"note":"右回り・直線266m・平坦基調（高低差0.7m）"},
      "2000":{"note":"右回り・直線266m・平坦基調（高低差0.7m）"},
      "2600":{"note":"右回り・直線266m・平坦基調（高低差0.7m）"}
    },
    "ダ": {
      "1000":{"note":"右回り・直線264m相当・ほぼ平坦（高低差0.7m）"},
      "1700":{"note":"右回り・直線264m相当・わずかに起伏（高低差0.7m）"},
      "2400":{"note":"右回り・直線264m相当・わずかに起伏（高低差0.7m）"}
    }
  },
  "函館": {
    "meta": {"turn":"右回り","straight":262,"elev":3.4,"slope_h":1.8,"shape":"小回り"},
    "芝": {
      "1000":{"note":"右回り・直線262m・ゴール前坂あり（坂高1.8m／高低差3.4m）・小回り"},
      "1200":{"note":"右回り・直線262m・坂あり（坂高1.8m／高低差3.4m）・小回り"},
      "1800":{"note":"右回り・直線262m・坂あり（坂高1.8m／高低差3.4m）"},
      "2000":{"note":"右回り・直線262m・坂あり（坂高1.8m／高低差3.4m）"}
    },
    "ダ": {
      "1000":{"note":"右回り・直線260m・坂あり（坂高1.8m／高低差3.4m）"},
      "1700":{"note":"右回り・直線260m・坂あり（坂高1.8m／高低差3.4m）"}
    }
  },
  "福島": {
    "meta": {"turn":"右回り","straight":292,"elev":1.9,"slope_h":1.0,"shape":"小回り"},
    "芝": {
      "1000":{"note":"右回り・直線292m・坂あり（坂高1.0m／高低差1.9m）・小回り"},
      "1200":{"note":"右回り・直線292m・坂あり（坂高1.0m／高低差1.9m）・小回り"},
      "1800":{"note":"右回り・直線292m・坂あり（坂高1.0m／高低差1.9m）"},
      "2000":{"note":"右回り・直線292m・坂あり（坂高1.0m／高低差1.9m）"}
    },
    "ダ": {
      "1150":{"note":"右回り・直線295m・坂あり（坂高1.0m／高低差1.9m）"},
      "1700":{"note":"右回り・直線295m・坂あり（坂高1.0m／高低差1.9m）"},
      "2400":{"note":"右回り・直線295m・坂あり（坂高1.0m／高低差1.9m）"}
    }
  },
  "新潟": {
    "meta": {"turn":"左回り","straight":659,"elev":0.0,"slope_h":0.0,"shape":"大回り・直線長"},
    "芝": {
      "1000":{"note":"直線コース・坂なし・直線659m・平坦"},
      "1200":{"note":"左回り・直線659m・坂なし・外回り"},
      "1400":{"note":"左回り・直線659m・坂なし・外回り"},
      "1600":{"note":"左回り・直線659m・坂なし・外回り"},
      "1800":{"note":"左回り・直線659m・坂なし"},
      "2000":{"note":"左回り・直線659m・坂なし"},
      "2200":{"note":"左回り・直線659m・坂なし"}
    },
    "ダ": {
      "1200":{"note":"左回り・直線353m・坂なし・平坦"},
      "1800":{"note":"左回り・直線353m・坂なし・平坦"},
      "2500":{"note":"左回り・直線353m・坂なし・平坦"}
    }
  },
  "東京": {
    "meta": {"turn":"左回り","straight":526,"elev":2.0,"slope_h":1.5,"shape":"大回り"},
    "芝": {
      "1400":{"note":"左回り・直線526m・ゴール前坂あり（坂高1.5m／高低差2.0m）・外回り"},
      "1600":{"note":"左回り・直線526m・ゴール前坂あり（坂高1.5m／高低差2.0m）・外回り"},
      "1800":{"note":"左回り・直線526m・ゴール前坂あり（坂高1.5m／高低差2.0m）"},
      "2000":{"note":"左回り・直線526m・ゴール前坂あり（坂高1.5m／高低差2.0m）・2コーナー発走"},
      "2400":{"note":"左回り・直線526m・ゴール前坂あり（坂高1.5m／高低差2.0m）"},
      "2500":{"note":"左回り・直線526m・ゴール前坂あり（坂高1.5m／高低差2.0m）"},
      "3400":{"note":"左回り・直線526m・ゴール前坂あり（坂高1.5m／高低差2.0m）"}
    },
    "ダ": {
      "1300":{"note":"左回り・直線501m・ゴール前坂あり（坂高1.5m／高低差2.0m）"},
      "1400":{"note":"左回り・直線501m・ゴール前坂あり（坂高1.5m／高低差2.0m）"},
      "1600":{"note":"左回り・直線501m・ゴール前坂あり（坂高1.5m／高低差2.0m）・芝スタート","turf_start":true},
      "2100":{"note":"左回り・直線501m・ゴール前坂あり（坂高1.5m／高低差2.0m）"}
    }
  },
  "中山": {
    "meta": {"turn":"右回り","straight":310,"elev":5.3,"slope_h":2.4,"shape":"小回り"},
    "芝": {
      "1200":{"note":"右回り・直線310m・急坂あり（坂高2.4m／高低差5.3m）・小回り"},
      "1600":{"note":"右回り・直線310m・急坂あり（坂高2.4m／高低差5.3m）・外回り"},
      "1800":{"note":"右回り・直線310m・急坂あり（坂高2.4m／高低差5.3m）"},
      "2000":{"note":"右回り・直線310m・急坂あり（坂高2.4m／高低差5.3m）・内回り"},
      "2200":{"note":"右回り・直線310m・急坂あり（坂高2.4m／高低差5.3m）"},
      "2500":{"note":"右回り・直線310m・急坂あり（坂高2.4m／高低差5.3m）"}
    },
    "ダ": {
      "1200":{"note":"右回り・直線308m・急坂あり（坂高2.4m／高低差5.3m）"},
      "1800":{"note":"右回り・直線308m・急坂あり（坂高2.4m／高低差5.3m）"}
    }
  },
  "中京": {
    "meta": {"turn":"左回り","straight":412,"elev":3.5,"slope_h":2.0,"shape":"標準"},
    "芝": {
      "1200":{"note":"左回り・直線412m・ゴール前坂あり（坂高2.0m／高低差3.5m）"},
      "1400":{"note":"左回り・直線412m・坂あり（坂高2.0m／高低差3.5m）"},
      "1600":{"note":"左回り・直線412m・坂あり（坂高2.0m／高低差3.5m）"},
      "2000":{"note":"左回り・直線412m・坂あり（坂高2.0m／高低差3.5m）"},
      "2200":{"note":"左回り・直線412m・坂あり（坂高2.0m／高低差3.5m）"}
    },
    "ダ": {
      "1200":{"note":"左回り・直線375m・坂あり（坂高2.0m／高低差3.5m）"},
      "1400":{"note":"左回り・直線375m・坂あり（坂高2.0m／高低差3.5m）・芝スタート","turf_start":true},
      "1800":{"note":"左回り・直線375m・坂あり（坂高2.0m／高低差3.5m）"},
      "1900":{"note":"左回り・直線375m・坂あり（坂高2.0m／高低差3.5m）"}
    }
  },
  "京都": {
    "meta": {"turn":"右回り","straight":404,"elev":4.3,"slope_h":2.0,"shape":"内外あり"},
    "芝": {
      "1200":{"note":"右回り・直線404m・ゴール前坂あり（坂高2.0m／高低差4.3m）・内回り"},
      "1400":{"note":"右回り・直線404m・ゴール前坂あり（坂高2.0m／高低差4.3m）・内回り"},
      "1600":{"note":"右回り・直線404m・坂あり（坂高2.0m／高低差4.3m）・外回り"},
      "1800":{"note":"右回り・直線404m・坂あり（坂高2.0m／高低差4.3m）・外回り"},
      "2000":{"note":"右回り・直線404m・坂あり（坂高2.0m／高低差4.3m）・内回り"},
      "2200":{"note":"右回り・直線328m・坂あり（坂高2.0m／高低差4.3m）・内回り"},
      "2400":{"note":"右回り・直線404m・坂あり（坂高2.0m／高低差4.3m）・外回り"},
      "3000":{"note":"右回り・直線404m・坂あり（坂高2.0m／高低差4.3m）・内回り"},
      "3200":{"note":"右回り・直線404m・坂あり（坂高2.0m／高低差4.3m）・外回り"}
    },
    "ダ": {
      "1200":{"note":"右回り・直線329m・概ね平坦（高低差2.0m）"},
      "1400":{"note":"右回り・直線329m・概ね平坦（高低差2.0m）"},
      "1800":{"note":"右回り・直線329m・坂あり（目安 坂高1.0m／高低差2.0m）"},
      "1900":{"note":"右回り・直線329m・坂あり（目安 坂高1.0m／高低差2.0m）"}
    }
  },
  "阪神": {
    "meta": {"turn":"右回り","straight":473,"elev":1.8,"slope_h":1.2,"shape":"外回りあり"},
    "芝": {
      "1200":{"note":"右回り・直線356m（内回り）・坂あり（坂高1.2m／高低差1.8m）"},
      "1400":{"note":"右回り・直線473m（外回り）・坂あり（坂高1.2m／高低差1.8m）"},
      "1600":{"note":"右回り・外回り・直線473m・坂あり（坂高1.2m／高低差1.8m）"},
      "1800":{"note":"右回り・外回り・直線473m・坂あり（坂高1.2m／高低差1.8m）"},
      "2000":{"note":"右回り・内回り・直線356m・坂あり（坂高1.2m／高低差1.8m）"},
      "2200":{"note":"右回り・外回り・直線473m・坂あり（坂高1.2m／高低差1.8m）"},
      "2400":{"note":"右回り・外回り・直線473m・坂あり（坂高1.2m／高低差1.8m）"}
    },
    "ダ": {
      "1200":{"note":"右回り・直線352m・坂あり（坂高1.2m／高低差1.8m）"},
      "1400":{"note":"右回り・直線352m・坂あり（坂高1.2m／高低差1.8m）"},
      "1800":{"note":"右回り・直線352m・坂あり（坂高1.2m／高低差1.8m）・芝スタートの番組あり","turf_start":true},
      "2000":{"note":"右回り・直線352m・坂あり（坂高1.2m／高低差1.8m）"}
    }
  },
  "小倉": {
    "meta": {"turn":"右回り","straight":293,"elev":2.8,"slope_h":1.0,"shape":"小回り"},
    "芝": {
      "1200":{"note":"右回り・直線293m・坂なし〜緩やか（高低差2.8m）・小回り"},
      "1700":{"note":"右回り・直線293m・小回り・起伏あり（高低差2.8m）"},
      "1800":{"note":"右回り・直線293m・起伏あり（高低差2.8m）"},
      "2000":{"note":"右回り・直線293m・起伏あり（高低差2.8m）"}
    },
    "ダ": {
      "1000":{"note":"右回り・直線291m・平坦寄り（高低差2.8m）"},
      "1700":{"note":"右回り・直線291m・やや起伏（高低差2.8m）"},
      "2400":{"note":"右回り・直線291m・やや起伏（高低差2.8m）"}
    }
  }
};

/* ====== 2. 要素参照 ====== */
const $ = (q, el=document)=> el.querySelector(q);
const selT = $("#selTrack"), selS = $("#selSurf"), selD = $("#selDist");
const title = $("#title"), line1 = $("#line1"), line2 = $("#line2"), meta = $("#meta"), card = $("#card");
const inCv = $("#inCv"), inMo = $("#inMo");
const selMode = $("#selMode"), customBox = $("#customBox"), th1=$("#th1"), th2=$("#th2"), th3=$("#th3");
const courseGrid = $("#courseGrid");

let thresholds = { turf:[10,15,20], dirt:[7,10,13], custom:[10,15,20] };
let mode = "auto";

/* ====== 3. 初期化 ====== */
function init(){
  Object.keys(DATA).forEach(t=>{
    const o=document.createElement('option');
    o.value=t; o.textContent=t;
    selT.appendChild(o);
  });
  selT.value = "東京"; selS.value = "芝";
  selT.onchange = onChangeSel;
  selS.onchange = onChangeSel;
  selD.onchange = render;
  $("#btnCopy").onclick = copyText;
  $("#applyCond").onclick = applyCond;
  $("#clearCond").onclick = clearCond;
  selMode.onchange = onModeChange;
  $("#applyTh").onclick = ()=>{
    thresholds.custom = [Number(th1.value)||10, Number(th2.value)||15, Number(th3.value)||20];
    updateBars(); updateLegend();
  };

  refreshDists();
  render();
  updateLegend();
}

/* ====== 4. 目安モード変更 ====== */
function onModeChange(){
  mode = selMode.value;
  customBox.style.display = (mode==="custom") ? "flex" : "none";
  updateBars();
  updateLegend();
}

/* ====== 5. 今の目安を返す ====== */
function currentThreshold(){
  if (mode==="turf") return thresholds.turf;
  if (mode==="dirt") return thresholds.dirt;
  if (mode==="custom") return thresholds.custom;
  // auto
  return (selS.value==="芝") ? thresholds.turf : thresholds.dirt;
}

/* ====== 6. 凡例更新 ====== */
function updateLegend(){
  const th = currentThreshold();
  const el = $("#legendMo");
  el.innerHTML = `<span>良（≦${th[0]}%）</span><span>稍重（≦${th[1]}%）</span><span>重（≦${th[2]}%）</span><span>不良（＞${th[2]}%）</span>`;
}

/* ====== 7. 競馬場/馬場が変わったら距離を更新 ====== */
function onChangeSel(){
  refreshDists();
  render();
  updateBars();
  updateLegend();
}

/* ====== 8. 距離セレクト更新 ====== */
function refreshDists(){
  selD.innerHTML="";
  const t = selT.value, s = selS.value;
  const dists = Object.keys(DATA[t][s]).sort((a,b)=>Number(a)-Number(b));
  dists.forEach(d=>{
    const o=document.createElement('option'); o.value=d; o.textContent=d;
    selD.appendChild(o);
  });
}

/* ====== 9. 画面表示の更新 ====== */
function render(){
  const t=selT.value, s=selS.value, d=selD.value;
  const metaInfo = DATA[t].meta;
  const rec = DATA[t][s][d];

  title.innerHTML = `<span class="tag ${s==="芝"?"turf":"dirt"}">${s}</span>${t}・${d}m`;
  card.classList.remove('turf','dirt');
  card.classList.add(s==="芝" ? 'turf':'dirt');

  line1.textContent = rec?.note || "（準備中）";
  line2.textContent = s==="ダ" && rec?.turf_start ? "芝スタート距離です。" : "";
  meta.textContent = `基本情報：${metaInfo.turn}／直線${metaInfo.straight}m／高低差${metaInfo.elev}m／坂高${metaInfo.slope_h}m／形状${metaInfo.shape}`;

  // 小カード
  courseGrid.innerHTML = "";
  const frag = document.createDocumentFragment();
  const c1 = document.createElement("div");
  c1.className="cg"; c1.innerHTML = "回り <strong>"+metaInfo.turn+"</strong>";
  frag.appendChild(c1);
  const c2 = document.createElement("div");
  c2.className="cg"; c2.innerHTML = "直線 <strong>"+metaInfo.straight+"m</strong>";
  frag.appendChild(c2);
  const c3 = document.createElement("div");
  c3.className="cg"; c3.innerHTML = "高低差 <strong>"+metaInfo.elev+"m</strong>";
  frag.appendChild(c3);
  const c4 = document.createElement("div");
  c4.className="cg"; c4.innerHTML = "坂高 <strong>"+metaInfo.slope_h+"m</strong>";
  frag.appendChild(c4);
  const c5 = document.createElement("div");
  c5.className="cg"; c5.innerHTML = "形状 <strong>"+metaInfo.shape+"</strong>";
  frag.appendChild(c5);
  if (s==="ダ" && rec?.turf_start){
    const c6 = document.createElement("div");
    c6.className="cg"; c6.innerHTML = "芝スタート <strong>あり</strong>";
    frag.appendChild(c6);
  }
  courseGrid.appendChild(frag);
}

/* ====== 10. バー描画 ====== */
function setBar(barId, labelId, value, min, max, formatter){
  const pct = Math.max(0, Math.min(100, (value-min) * 100 / (max-min)));
  const bar = document.getElementById(barId).querySelector(".fill");
  bar.style.width = isFinite(pct)? (pct + "%") : "0%";
  // バッジ表示したいのでinnerHTMLで
  document.getElementById(labelId).innerHTML = formatter(value);
}

/* ====== 11. 含水率をラベルに変換（バッジ付き） ====== */
function labelMoist(val){
  if (!isFinite(val)) return "—";
  const t = currentThreshold();
  const lab = (val<=t[0]?"良": val<=t[1]?"稍重": val<=t[2]?"重":"不良");
  const badgeClass = (lab==="良"?"cond-good": lab==="稍重"?"cond-yayo":"cond-heavy");
  return `<span class="cond-badge ${badgeClass}">${lab}</span> ${val.toFixed(1)}%`;
}

/* ====== 12. 反映ボタン ====== */
function applyCond(){
  const cv = Number(inCv.value), mo = Number(inMo.value);
  if (isFinite(cv)){
    window.__cv = cv;
    setBar("barCv","labCv", cv, 7.0, 11.5, v=> "CV " + v.toFixed(1));
  }
  if (isFinite(mo)){
    window.__mo = mo;
    setBar("barMo","labMo", mo, 0, 25, v=> labelMoist(mo));
  }
}

/* ====== 13. 手動でバー更新（目安を変えた時など） ====== */
function updateBars(){
  if (window.__cv != null)
    setBar("barCv","labCv", window.__cv, 7.0, 11.5, v=> "CV " + v.toFixed(1));
  else
    setBar("barCv","labCv", 0, 7.0, 11.5, ()=>"—");

  if (window.__mo != null)
    setBar("barMo","labMo", window.__mo, 0, 25, v=> labelMoist(window.__mo));
  else
    setBar("barMo","labMo", 0, 25, ()=>"—");
}

/* ====== 14. クリア ====== */
function clearCond(){
  window.__cv = undefined; window.__mo = undefined;
  setBar("barCv","labCv", 0, 7.0, 11.5, ()=>"—");
  setBar("barMo","labMo", 0, 25, ()=>"—");
  inCv.value=""; inMo.value="";
}

/* ====== 15. コピー ====== */
async function copyText(){
  const tLine = title.textContent;
  const l1 = line1.textContent;
  const l2 = line2.textContent ? line2.textContent + "\n" : "";
  const metaLine = meta.textContent;
  const today = `\n[本日の馬場] CV ${window.__cv ?? "—"} / 含水 ${window.__mo ?? "—"}% （目安: ${selMode.value}）`;
  const text = `${tLine}\n${l1}\n${l2}${metaLine}${today}`;
  try{
    await navigator.clipboard.writeText(text);
    alert("コピーしました");
  }catch(e){
    alert("コピーできませんでした");
  }
}

init();
</script>
</body>
</html>
