<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>JRAコース早見（本日入力版）</title>
  <style>
    :root {
      --bg: #f5f6f8;
      --card: #ffffff;
      --accent: #0f766e;
      --accent-soft: #d1fae5;
      --text: #0f172a;
      --muted: #64748b;
      --danger: #ef4444;
      --border: #e2e8f0;
    }
    body {
      margin: 0;
      background: var(--bg);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text);
    }
    header {
      background: var(--accent);
      color: #fff;
      padding: 14px 16px 10px;
      font-size: 1.25rem;
      font-weight: 700;
    }
    header small {
      display: block;
      font-weight: 400;
      font-size: .7rem;
      opacity: .8;
    }
    .tabs {
      display: flex;
      gap: 6px;
      padding: 10px 12px 4px;
      background: var(--bg);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .tab-btn {
      border: none;
      background: rgba(255,255,255,.0);
      padding: 7px 14px 6px;
      border-radius: 9999px;
      font-weight: 600;
      font-size: .85rem;
      color: var(--muted);
    }
    .tab-btn.active {
      background: #fff;
      color: var(--text);
      box-shadow: 0 5px 18px rgba(15,118,110,.12);
    }
    .page {
      display: none;
      padding: 10px 12px 50px;
    }
    .page.active {
      display: block;
    }
    .card {
      background: var(--card);
      border-radius: 18px;
      padding: 16px 16px 14px;
      box-shadow: 0 10px 30px rgba(15,23,42,.02);
      border: 1px solid rgba(226,232,240,.4);
      margin-bottom: 14px;
    }
    h2.section-title {
      margin: 0 0 10px;
      font-size: 1.1rem;
    }
    label {
      display: block;
      font-size: .7rem;
      color: var(--muted);
      margin-bottom: 4px;
    }
    select {
      width: 100%;
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 9px 12px;
      font-size: .9rem;
      background: #fff;
    }
    .field {
      margin-bottom: 12px;
    }
    .course-header {
      display: flex;
      gap: 6px;
      align-items: center;
      margin-bottom: 6px;
    }
    .surface-pill {
      background: #e0f2f1;
      color: #064e3b;
      font-weight: 600;
      border-radius: 9999px;
      padding: 3px 10px 2px;
      font-size: .7rem;
    }
    .course-title {
      font-size: 1.05rem;
      font-weight: 700;
    }
    .course-text {
      font-size: .8rem;
      line-height: 1.5;
      margin-bottom: 6px;
    }
    .inline-meta {
      font-size: .75rem;
      color: var(--muted);
      margin-bottom: 10px;
    }
    .info-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 6px;
      margin-bottom: 6px;
    }
    .info-box {
      background: #f8fafc;
      border: 1px solid rgba(209,213,219,.4);
      border-radius: 14px;
      padding: 6px 9px 4px;
    }
    .info-label {
      font-size: .65rem;
      color: var(--muted);
      margin-bottom: 2px;
    }
    .info-value {
      font-size: .85rem;
      font-weight: 600;
    }
    .bar-wrapper {
      margin-bottom: 6px;
    }
    .bar-label {
      display: flex;
      justify-content: space-between;
      font-size: .65rem;
      color: var(--muted);
      margin-bottom: 3px;
    }
    .bar-track {
      height: 7px;
      background: #e2e8f0;
      border-radius: 9999px;
      overflow: hidden;
    }
    .bar-fill {
      height: 100%;
      background: #0f766e;
      width: 0;
      transition: width .2s;
    }
    .sub-text {
      font-size: .7rem;
      color: var(--muted);
      margin-bottom: 4px;
    }
    .input-row {
      display: flex;
      gap: 6px;
      margin-bottom: 6px;
    }
    .small-input {
      flex: 1;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 6px 10px 5px;
      font-size: .8rem;
    }
    .small-btn {
      border: none;
      background: var(--accent);
      color: #fff;
      border-radius: 12px;
      padding: 5px 12px 4px;
      font-size: .75rem;
    }
    .track-btn {
      border: none;
      background: #fff;
      border: 1px solid rgba(15,118,110,.15);
      color: #0f766e;
      border-radius: 9999px;
      padding: 3px 12px 3px;
      font-size: .7rem;
    }
    .table-like {
      font-size: .72rem;
      border-bottom: 1px solid rgba(226,232,240,.5);
      padding: 6px 0 7px;
      display: flex;
      gap: 6px;
      align-items: center;
    }
    .tag {
      background: rgba(15,118,110,.08);
      color: #0f766e;
      border-radius: 9999px;
      padding: 2px 8px;
      font-size: .6rem;
      font-weight: 600;
    }
    @media (min-width:700px){
      .page{max-width: 640px;margin:0 auto;}
    }
  </style>
</head>
<body>
  <header>
    JRAコース早見
    <small>本日入力版（タブ2でまとめて入力 → タブ1に表示）</small>
  </header>

  <div class="tabs">
    <button class="tab-btn active" data-tab="view">タブ1：見る用</button>
    <button class="tab-btn" data-tab="input">タブ2：今日の数値を入れる</button>
  </div>

  <!-- タブ1：見るだけ -->
  <div class="page active" id="page-view">
    <div class="card">
      <h2 class="section-title">1) 選ぶ</h2>
      <div class="field">
        <label>競馬場</label>
        <select id="selCourse">
          <option>東京</option>
          <option>中山</option>
          <option>京都</option>
          <option>阪神</option>
          <option>小倉</option>
          <option>新潟</option>
          <option>中京</option>
          <option>札幌</option>
          <option>函館</option>
          <option>福島</option>
        </select>
      </div>
      <div class="field">
        <label>馬場</label>
        <select id="selSurface">
          <option value="芝">芝</option>
          <option value="ダート">ダート</option>
        </select>
      </div>
      <div class="field">
        <label>距離</label>
        <select id="selDistance">
          <option value="2000">2000</option>
          <option value="1600">1600</option>
          <option value="1800">1800</option>
          <option value="1200">1200</option>
          <option value="2400">2400</option>
        </select>
      </div>
      <button id="btnCopy" class="small-btn" style="width:100%;">テキストをコピー</button>
      <p class="sub-text">※ページを閉じるとリセット。今日だけのメモ用。</p>
    </div>

    <div class="card" id="viewCard">
      <!-- JSで埋める -->
    </div>
  </div>

  <!-- タブ2：全場入力 -->
  <div class="page" id="page-input">
    <div class="card">
      <h2 class="section-title">今日の馬場傾向をまとめて入力</h2>
      <p class="sub-text">1行ずつ入れていくと、タブ1に反映されます（同じキーなら上書き）。</p>
    </div>
    <div id="inputList"></div>
  </div>

<script>
  // 基本データ（ここにコース特徴を入れてる）
  const COURSES = {
    "東京": {
      "芝": {
        distances: [1400,1600,1800,2000,2400,2500,3400],
        info: {
          2000: {
            turn: "左回り",
            straight: 526,
            slopePlace: "ゴール前坂あり",
            slope: 1.5,
            diff: 2.0,
            shape: "大回り",
            start: "2コーナー発走",
          },
          1600: {
            turn: "左回り",
            straight: 526,
            slopePlace: "ゴール前坂あり",
            slope: 1.5,
            diff: 2.0,
            shape: "ワンターン",
            start: "正面スタンド前",
          }
        },
        defaultAvg: { pass: 58.0, last3f: 34.0 }
      },
      "ダート": {
        distances: [1300,1400,1600,2100],
        info: {},
        defaultAvg: { pass: 61.0, last3f: 36.5 }
      }
    },
    "中山": {
      "芝": {
        distances: [1200,1600,1800,2000,2200,2500],
        info: {
          2000: {
            turn: "右回り",
            straight: 310,
            slopePlace: "ゴール前急坂",
            slope: 2.2,
            diff: 5.3,
            shape: "小回り",
            start: "スタンド前",
          }
        },
        defaultAvg: { pass: 59.5, last3f: 35.0 }
      },
      "ダート": {
        distances: [1200,1800,2400],
        info: {},
        defaultAvg: { pass: 62.0, last3f: 37.0 }
      }
    },
    "京都": {
      "芝": {
        distances: [1200,1400,1600,1800,2000,2200,3000],
        info: {
          2000: {
            turn: "右回り",
            straight: 404,
            slopePlace: "ゴール前わずかに上り",
            slope: 1.0,
            diff: 3.5,
            shape: "内回り",
            start: "2コーナーポケット",
          }
        },
        defaultAvg: { pass: 58.8, last3f: 34.6 }
      },
      "ダート": {
        distances: [1200,1400,1800,1900],
        info: {},
        defaultAvg: { pass: 61.5, last3f: 37.2 }
      }
    },
    "阪神": {
      "芝": {
        distances: [1200,1400,1600,1800,2000,2400],
        info: {
          1600: {
            turn: "右回り",
            straight: 473,
            slopePlace: "ゴール前坂あり",
            slope: 1.8,
            diff: 2.0,
            shape: "外回り",
            start: "向正面",
          }
        },
        defaultAvg: { pass: 58.7, last3f: 34.5 }
      },
      "ダート": {
        distances: [1200,1400,1800,2000],
        info: {},
        defaultAvg: { pass: 62.4, last3f: 37.0 }
      }
    },
    "小倉": {
      "芝": {
        distances: [1200,1700,1800,2000],
        info: {
          1800: {
            turn: "右回り",
            straight: 293,
            slopePlace: "ゴール前わずかに上り",
            slope: 0.6,
            diff: 3.0,
            shape: "小回り",
            start: "4コーナーポケット",
          }
        },
        defaultAvg: { pass: 59.0, last3f: 35.3 }
      },
      "ダート": {
        distances: [1000,1700,2400],
        info: {},
        defaultAvg: { pass: 63.0, last3f: 37.5 }
      }
    }
  };

  // 本日の値を入れておく入れ物
  let todayValues = {};
  Object.keys(COURSES).forEach(track => {
    todayValues[track] = {
      turf: { cushion: "", moisture: "" },
      dirt: { moisture: "" }
    };
  });

  // DOM
  const tabBtns = document.querySelectorAll(".tab-btn");
  const tabView = document.getElementById("tab-view");
  const tabInput = document.getElementById("tab-input");
  const selTrack = document.getElementById("selTrack");
  const selSurface = document.getElementById("selSurface");
  const selDist = document.getElementById("selDist");
  const courseInfo = document.getElementById("courseInfo");
  const inputList = document.getElementById("inputList");

  // タブ切り替え
  tabBtns.forEach(btn => {
    btn.addEventListener("click", () => {
      tabBtns.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      const tab = btn.dataset.tab;
      if (tab === "view") {
        tabView.style.display = "block";
        tabInput.style.display = "none";
      } else {
        tabView.style.display = "none";
        tabInput.style.display = "block";
      }
    });
  });

  // セレクト初期化
  function initSelectors() {
    Object.keys(COURSES).forEach(track => {
      const opt = document.createElement("option");
      opt.value = track;
      opt.textContent = track;
      selTrack.appendChild(opt);
    });
    updateDistanceOptions();
  }

  function updateDistanceOptions() {
    const track = selTrack.value;
    const surf = selSurface.value;
    selDist.innerHTML = "";
    const arr = COURSES[track][surf].distances;
    arr.forEach(d => {
      const opt = document.createElement("option");
      opt.value = d;
      opt.textContent = d;
      selDist.appendChild(opt);
    });
  }

  selTrack.addEventListener("change", () => {
    updateDistanceOptions();
    renderCourse();
  });
  selSurface.addEventListener("change", () => {
    updateDistanceOptions();
    renderCourse();
  });
  selDist.addEventListener("change", renderCourse);

  // コース表示
  function renderCourse() {
    const track = selTrack.value;
    const surf = selSurface.value;
    const dist = Number(selDist.value);

    const surfData = COURSES[track][surf];
    const info = (surfData.info && surfData.info[dist]) ? surfData.info[dist] : null;
    const avg = surfData.defaultAvg || { pass: "-", last3f: "-" };

    const tv = todayValues[track];
    let cushionTxt = "-";
    let moistTxt = "-";
    if (surf === "芝") {
      cushionTxt = tv.turf.cushion !== "" ? tv.turf.cushion : "-";
      moistTxt = tv.turf.moisture !== "" ? tv.turf.moisture + "%" : "-%";
    } else {
      moistTxt = tv.dirt.moisture !== "" ? tv.dirt.moisture + "%" : "-%";
    }

    const cushionVal = surf === "芝" ? Number(tv.turf.cushion || 0) : 0;
    const moistVal = surf === "芝" ? Number(tv.turf.moisture || 0) : Number(tv.dirt.moisture || 0);

    let cushionColor = "#dbe5eb";
    if (surf === "芝" && cushionVal > 0) {
      if (cushionVal <= 8) cushionColor = "#f97316";
      else if (cushionVal <= 10) cushionColor = "#84cc16";
      else cushionColor = "#60a5fa";
    }
    let moistureColor = "#dbe5eb";
    if (moistVal > 0) {
      if (moistVal <= 15) moistureColor = "#84cc16";
      else if (moistVal <= 23) moistureColor = "#fbbf24";
      else moistureColor = "#f97316";
    }

    const cushionWidth = Math.min(cushionVal * 9, 100);
    const moistureWidth = Math.min(moistVal * 3.3, 100);

    courseInfo.innerHTML = `
      <div class="card course-card" style="background:${surf === "芝" ? "#e6f7e1" : "#d6b38a"};">
        <div class="course-title">
          <span class="tag" style="background:${surf === '芝' ? '#22c55e' : '#8b4513'};color:#fff;">
            ${surf === "芝" ? "芝" : "ダート"}
          </span>
          <div style="font-size:1rem;">${track}・${surf}・${dist}m</div>
        </div>
        <div class="course-basic">
          ${info
            ? `${info.turn}・直線${info.straight}m・${info.slopePlace}（坂高${info.slope}m／高低差${info.diff}m）・${info.start}`
            : "この距離の詳細はまだ入れていません"}
        </div>
        <div class="pill-grid">
          <div class="pill"><span class="label">回り</span><span class="big">${info ? info.turn : "－"}</span></div>
          <div class="pill"><span class="label">直線</span><span class="big">${info ? info.straight + "m" : "－"}</span></div>
          <div class="pill"><span class="label">坂</span><span class="big">${info ? info.slopePlace : "－"}</span></div>
          <div class="pill"><span class="label">高低差</span><span class="big">${info ? info.diff + "m" : "－"}</span></div>
          <div class="pill"><span class="label">形状</span><span class="big">${info ? info.shape : "－"}</span></div>
        </div>
        <div style="margin-top:10px;font-size:.7rem;font-weight:600;">基準タイム目安</div>
        <div class="pill-grid">
          <div class="pill"><span class="label">基準通過</span><span class="big">${avg.pass} 秒</span></div>
          <div class="pill"><span class="label">基準上がり3F</span><span class="big">${avg.last3f} 秒</span></div>
        </div>
        <div style="margin-top:12px;">
          <div class="label">クッション値</div>
          <div class="bar"><div class="bar-inner" style="width:${cushionWidth}%;background:${cushionColor};"></div></div>
          <div class="bar-label-line">
            <span>${surf === "芝" ? (cushionTxt === "-" ? "入力なし" : cushionTxt) : "芝でのみ表示"}</span>
            <span>硬め ←→ 柔らかめ</span>
          </div>
        </div>
        <div style="margin-top:6px;">
          <div class="label">${surf === "芝" ? "芝 含水率" : "ダート 含水率"}</div>
          <div class="bar"><div class="bar-inner" style="width:${moistureWidth}%;background:${moistureColor};"></div></div>
          <div class="bar-label-line"><span>${moistTxt}</span><span>良 ←→ 重・不良</span></div>
        </div>
        <button class="copy-btn" onclick="copyCardText()">テキストをコピー</button>
      </div>`;
  }

  // タブ2の入力リスト
  function renderInputList() {
    inputList.innerHTML = "";
    Object.keys(COURSES).forEach(track => {
      const block = document.createElement("div");
      block.className = "track-input-block";
      block.innerHTML = `
        <div style="font-weight:700;margin-bottom:4px;">${track}</div>
        <div class="inline-inputs">
          <span style="font-size:.65rem;">芝 クッション</span>
          <input type="number" step="0.1" data-track="${track}" data-field="turf.cushion" placeholder="10">
          <span style="font-size:.65rem;">芝 含水</span>
          <input type="number" step="0.1" data-track="${track}" data-field="turf.moisture" placeholder="20">
        </div>
        <div class="inline-inputs">
          <span style="font-size:.65rem;">ダート 含水</span>
          <input type="number" step="0.1" data-track="${track}" data-field="dirt.moisture" placeholder="5">
          <button class="small-btn" data-apply="${track}">反映</button>
        </div>`;
      inputList.appendChild(block);
    });
    inputList.querySelectorAll("button[data-apply]").forEach(btn => {
      btn.addEventListener("click", () => {
        const track = btn.dataset.apply;
        const inputs = inputList.querySelectorAll(`input[data-track="${track}"]`);
        inputs.forEach(inp => {
          const field = inp.dataset.field;
          const val = inp.value.trim();
          if (field === "turf.cushion") todayValues[track].turf.cushion = val;
          if (field === "turf.moisture") todayValues[track].turf.moisture = val;
          if (field === "dirt.moisture") todayValues[track].dirt.moisture = val;
        });
        if (selTrack.value === track) renderCourse();
      });
    });
  }

  // テキストコピー
  function copyCardText() {
    const track = selTrack.value;
    const surf = selSurface.value;
    const dist = selDist.value;
    const surfData = COURSES[track][surf];
    const info = (surfData.info && surfData.info[dist]) ? surfData.info[dist] : null;
    const avg = surfData.defaultAvg || { pass: "-", last3f: "-" };
    const tv = todayValues[track];
    const cushion = surf === "芝" ? (tv.turf.cushion || "-") : "-";
    const moist = surf === "芝" ? (tv.turf.moisture || "-") : (tv.dirt.moisture || "-");
    const lines = [];
    lines.push(`${track}・${surf}・${dist}m`);
    if (info) {
      lines.push(`${info.turn}／直線${info.straight}m／高低差${info.diff}m／${info.slopePlace}／${info.start}`);
    }
    lines.push(`基準通過: ${avg.pass}秒`);
    lines.push(`基準上がり3F: ${avg.last3f}秒`);
    lines.push(`芝クッション: ${cushion}`);
    lines.push(`${surf === "芝" ? "芝" : "ダート"}含水: ${moist}%`);
    navigator.clipboard.writeText(lines.join("\n"));
    alert("コースメモをコピーしました。");
  }

  initSelectors();
  renderInputList();
  renderCourse();
  window.copyCardText = copyCardText;
</script>
</body>
</html>
