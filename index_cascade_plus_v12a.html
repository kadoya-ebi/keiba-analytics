
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>早見表 v1.2a（コース特徴＋サンプル読込）</title>
<style>
  :root{ --bg:#f7f7f9;--card:#fff;--border:#e5e7eb;--text:#111;--muted:#6b7280; --accent:#2e7d32; --tint:#e9f7ee; --tagbg:#eefaf0;}
  body[data-surface="dirt"]{ --accent:#6d4c41; --tint:#f3e5dc; --tagbg:#f7eee8; }
  body{margin:0;background:linear-gradient(#fafafa,#f3f4f6);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP","Hiragino Kaku Gothic ProN",Meiryo,sans-serif;color:var(--text)}
  .wrap{max-width:1180px;margin:0 auto;padding:16px 16px 96px}
  h1{font-size:20px;margin:0 0 10px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 4px 12px rgba(0,0,0,.03);padding:16px;margin:12px 0}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .muted{color:var(--muted);font-size:12px}
  button{font:inherit;cursor:pointer;border:1px solid var(--border);background:#fff;border-radius:999px;padding:8px 14px}
  button.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
  input,select{padding:10px;border:1px solid var(--border);border-radius:12px;background:#fff}
  .seg{display:flex;gap:8px;flex-wrap:wrap}
  .seg button.active{background:var(--accent);color:#fff;border-color:var(--accent)}
  .grid{display:grid;gap:8px}
  .g-3{grid-template-columns:repeat(3,minmax(0,1fr))}
  .stat{border:1px solid var(--border);border-radius:16px;padding:12px;background:linear-gradient(0deg,var(--tint),#fff 45%)}
  .stat h3{font-size:12px;margin:0 0 6px;color:#555}
  .stat .v{font-size:20px;font-weight:700}
  .right{text-align:right}
  table{width:100%;border-collapse:collapse}
  thead th{position:sticky;top:0;background:#f7f7fb;border-bottom:2px solid var(--accent);text-align:left;font-weight:600;padding:10px}
  tbody td{border-top:1px solid var(--border);padding:10px;font-size:14px}
  tbody tr:nth-child(odd){background:var(--tint)}
  .tag{display:inline-block;padding:2px 8px;border:1px solid var(--border);border-radius:999px;font-size:12px;margin-right:4px;background:var(--tagbg)}
  .pill{display:inline-flex;align-items:center;gap:8px;background:var(--tint);border:1px solid var(--accent);color:var(--accent);padding:6px 10px;border-radius:999px;font-weight:700}
  .feat{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
  .feat .chip{border:1px solid var(--accent);color:var(--accent);background:#fff;border-radius:999px;padding:6px 10px;font-size:13px}
</style>
</head>
<body>
<div class="wrap">
  <h1>早見表（コース→馬場→距離）</h1>

  <div class="card">
    <div class="row" style="justify-content:space-between">
      <div class="row">
        <button id="a_export">CSV書き出し</button>
        <label><span style="padding:8px 14px;border:1px solid var(--border);border-radius:999px;background:#fff;cursor:pointer;display:inline-block">CSV読み込み<input id="a_import" type="file" accept=".csv,text/csv" style="display:none"></span></label>
        <button id="a_clear">全消去</button>
        <button id="a_preset" class="primary">プリセット適用</button>
        <button id="a_sample">サンプル読込</button>
      </div>
      <div class="row">
        <label class="muted">コース特徴CSV<input id="feat_import" type="file" accept=".csv,text/csv" style="display:inline-block;border:1px solid var(--border);border-radius:10px;padding:6px 10px;margin-left:6px"></label>
      </div>
    </div>
    <div class="muted">レース行の列：date,track,surface,distance,pass,last3f,cushion,moisture,going,course,course_variant,turf_start,straight_len,course_shape,turn_dir,finish_slope,straight_len_m,elevation_diff</div>
  </div>

  <div class="card">
    <div class="row" style="justify-content:space-between;align-items:center">
      <div style="min-width:280px">
        <div><strong>1) コース</strong></div>
        <div class="seg" id="segTrack"></div>
      </div>
      <div>
        <span id="surfacePill" class="pill" style="display:none">—</span>
      </div>
    </div>
    <div style="height:6px"></div>
    <div><strong>2) 馬場</strong></div>
    <div class="seg" id="segSurface">
      <button data-surface="芝" class="active">芝</button>
      <button data-surface="ダ">ダート</button>
    </div>
    <div style="height:6px"></div>
    <div class="row" style="justify-content:space-between;align-items:flex-end">
      <div><strong>3) 距離</strong> <span class="muted" id="distanceNote"></span></div>
      <div class="row">
        <label class="muted">芝スタート <select id="fTurf"><option value="">指定なし</option><option value="true">あり</option><option value="false">なし</option></select></label>
        <label class="muted">直線 <select id="fStraight"><option value="">指定なし</option><option>長い</option><option>普通</option><option>短い</option></select></label>
        <label class="muted">コース形状 <select id="fShape"><option value="">指定なし</option><option>小回り</option><option>大回り</option><option>普通</option></select></label>
        <label class="muted">回り <select id="fTurn"><option value="">指定なし</option><option>右回り</option><option>左回り</option><option>直線</option></select></label>
        <label class="muted">内外/レール <select id="fVariant"><option value="">指定なし</option><option>内</option><option>外</option><option>A</option><option>B</option><option>C</option><option>D</option></select></label>
      </div>
    </div>
    <div class="seg" id="segDistance"></div>
    <div class="muted">基準通過：1000〜1200→600m、1400〜1600→800m、1800以上→1000m</div>
  </div>

  <div id="panel" class="card" style="display:none">
    <div class="row" style="justify-content:space-between;align-items:center">
      <strong id="title">—</strong>
      <div class="muted" id="count">—</div>
    </div>
    <div class="grid g-3" style="margin-top:8px">
      <div class="stat"><h3>平均 通過</h3><div class="v" id="avgPass">—</div></div>
      <div class="stat"><h3>平均 上がり3F</h3><div class="v" id="avgLast3f">—</div></div>
      <div class="stat"><h3>平均 クッション</h3><div class="v" id="avgCv">—</div></div>
      <div class="stat"><h3>平均 含水率(%)</h3><div class="v" id="avgMoist">—</div></div>
      <div class="stat"><h3>Pace 判定</h3><div class="v" id="pace">—</div></div>
      <div class="stat"><h3>基準ラベル</h3><div class="v" id="base">—</div></div>
    </div>

    <div class="card" style="margin-top:12px">
      <div class="row" style="justify-content:space-between;align-items:center">
        <strong>コース特徴</strong>
        <span class="muted" id="featSource">（内蔵/CSV）</span>
      </div>
      <div class="feat" id="featChips"></div>
      <div class="muted" id="featNotes" style="margin-top:6px"></div>
    </div>
  </div>

  <details class="card">
    <summary><strong>明細（選択中の条件）</strong></summary>
    <div style="overflow:auto;border:1px solid var(--border);border-radius:12px;margin-top:8px">
      <table id="tbl">
        <thead><tr><th>日付</th><th>場</th><th>馬場</th><th class="right">距離</th><th>基準</th><th>Variant</th><th class="right">通過</th><th class="right">上がり3F</th><th class="right">CV</th><th class="right">含水</th><th>状態</th><th>コース</th><th>特性</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </details>
</div>

<script>
(function(){
  const ls = "keiba_cascade_rows_v11";
  const featLS = "keiba_course_features_v12";
  const tracks = ["札幌","函館","福島","新潟","東京","中山","中京","京都","阪神","小倉"];
  const $ = (q, el=document)=> el.querySelector(q);
  const $$ = (q, el=document)=> Array.from(el.querySelectorAll(q));
  function load(){ try{ return JSON.parse(localStorage.getItem(ls))||[] }catch{ return [] } }
  function save(rows){ localStorage.setItem(ls, JSON.stringify(rows)); }
  function fmt(n, d=1){ return (n===undefined||n===null||!isFinite(n)) ? "—" : Number(n).toFixed(d); }
  function baseLabel(d){ if (!d) return ""; if (d<=1200) return "600m"; if (d<=1600) return "800m"; return "1000m"; }
  function uniq(a){ return Array.from(new Set(a)); }

  const builtInFeat = {};
  ["札幌","函館","福島","新潟","東京","中山","中京","京都","阪神","小倉"].forEach(t=>{
    builtInFeat[t] = {
      "芝": {turn_dir: (t==="新潟"?"左回り":"右回り"), straight_len_m: {札幌:266,函館:262,福島:292,新潟:659,東京:526,中山:310,中京:412,京都:404,阪神:473,小倉:293}[t], straight_len: {札幌:"普通",函館:"普通",福島:"短い",新潟:"長い",東京:"長い",中山:"普通",中京:"普通",京都:"長い",阪神:"長い",小倉:"短い"}[t], elevation_diff_m: {札幌:0.7,函館:3.5,福島:1.9,新潟:2.2,東京:2.0,中山:5.3,中京:3.5,京都:4.3,阪神:1.8,小倉:2.8}[t], finish_slope: {札幌:"なし",函館:"あり",福島:"あり",新潟:"なし",東京:"あり",中山:"あり",中京:"あり",京都:"あり",阪神:"あり",小倉:"なし"}[t], slope_position: {札幌:"—",函館:"ゴール前",福島:"ゴール前",新潟:"—",東京:"ゴール前",中山:"ゴール前",中京:"ゴール前",京都:"ゴール前",阪神:"ゴール前",小倉:"—"}[t], course_shape:{札幌:"普通",函館:"普通",福島:"小回り",新潟:"大回り",東京:"大回り",中山:"小回り",中京:"普通",京都:"大回り",阪神:"大回り",小倉:"小回り"}[t], turf_start: "—", turf_start_note: "—", notes: (t==="新潟"?"芝1000は直線コース":"") },
      "ダ": {turn_dir: (t==="新潟"?"左回り":"右回り"), straight_len_m: {札幌:266,函館:262,福島:292,新潟:659,東京:526,中山:310,中京:412,京都:404,阪神:473,小倉:293}[t], straight_len: {札幌:"短い",函館:"短い",福島:"短い",新潟:"普通",東京:"普通",中山:"短い",中京:"普通",京都:"普通",阪神:"普通",小倉:"短い"}[t], elevation_diff_m: {札幌:0.7,函館:3.5,福島:1.9,新潟:2.2,東京:2.0,中山:5.3,中京:3.5,京都:4.3,阪神:1.8,小倉:2.8}[t], finish_slope: {札幌:"なし",函館:"あり",福島:"あり",新潟:"なし",東京:"あり",中山:"あり",中京:"あり",京都:"あり",阪神:"あり",小倉:"なし"}[t], slope_position: {札幌:"—",函館:"ゴール前",福島:"ゴール前",新潟:"—",東京:"ゴール前",中山:"ゴール前",中京:"ゴール前",京都:"ゴール前",阪神:"ゴール前",小倉:"—"}[t], course_shape:{札幌:"普通",函館:"普通",福島:"小回り",新潟:"大回り",東京:"大回り",中山:"小回り",中京:"普通",京都:"大回り",阪神:"大回り",小倉:"小回り"}[t], turf_start: (t==="東京"?"1600":(t==="中京"?"1400":"無し")), turf_start_note: (t==="東京"?"ダ1600は芝スタート":(t==="中京"?"ダ1400は芝スタート":"無し")), notes: (t==="新潟"?"":"") }
    };
  });

  function loadFeat(){ try{ return JSON.parse(localStorage.getItem(featLS))||null }catch{ return null } }
  function saveFeat(obj){ localStorage.setItem(featLS, JSON.stringify(obj)); }

  let rows = load();
  let feat = loadFeat();
  const state = {track:null, surface:"芝", distance:null};

  const segT = document.getElementById("segTrack");
  tracks.forEach(t=>{
    const b=document.createElement("button"); b.textContent=t; b.dataset.track=t;
    b.onclick=()=>{ $$("#segTrack button").forEach(x=>x.classList.remove("active")); b.classList.add("active"); state.track=t; renderDistances(); update(); };
    segT.appendChild(b);
  });

  $$("#segSurface button").forEach(b=> b.onclick=()=>{
    $$("#segSurface button").forEach(x=>x.classList.remove("active"));
    b.classList.add("active");
    state.surface=b.dataset.surface;
    document.body.dataset.surface = (state.surface==="芝" ? "turf" : "dirt");
    const pill=document.getElementById("surfacePill");
    pill.style.display="inline-flex";
    pill.textContent = (state.surface==="芝"?"芝（GREEN）":"ダート（BROWN）");
    renderDistances(); update();
  });

  ["fTurf","fStraight","fShape","fTurn","fVariant"].forEach(id=> document.getElementById(id).addEventListener("change", update));

  function renderDistances(){
    const seg=document.getElementById("segDistance"); seg.innerHTML="";
    let ds=[];
    if (state.track && state.surface){
      ds = uniq(rows.filter(r=> r.track===state.track && r.surface===state.surface).map(r=> Number(r.distance)).filter(Boolean)).sort((a,b)=>a-b);
      document.getElementById("distanceNote").textContent = ds.length? "（この場×馬場のCSV内の距離のみ表示）" : "（CSV未読込：代表的な距離を表示）";
    }
    if (ds.length===0){ ds=[1000,1100,1150,1200,1300,1400,1500,1600,1700,1800,1900,2000,2100,2200,2300,2400,2500,3000]; }
    ds.forEach(d=>{
      const b=document.createElement("button"); b.textContent=d; b.dataset.distance=d;
      b.onclick=()=>{ $$("#segDistance button").forEach(x=>x.classList.remove("active")); b.classList.add("active"); state.distance=Number(d); update(); };
      seg.appendChild(b);
    });
  }

  function applyFilters(r){
    const fT = document.getElementById("fTurf").value;
    const fS = document.getElementById("fStraight").value;
    const fC = document.getElementById("fShape").value;
    const fR = document.getElementById("fTurn").value;
    const fV = document.getElementById("fVariant").value;
    if (fT!==""){ const val = (r.turf_start===true?"true": r.turf_start===false?"false": ""); if (val!==fT) return false; }
    if (fS!=="" && (r.straight_len||"") !== fS) return false;
    if (fC!=="" && (r.course_shape||"") !== fC) return false;
    if (fR!=="" && (r.turn_dir||"") !== fR) return false;
    if (fV!=="" && (r.course_variant||"") !== fV) return false;
    return true;
  }

  function filtered(){
    return rows.filter(r=> (!state.track || r.track===state.track) && (!state.surface || r.surface===state.surface) && (!state.distance || Number(r.distance)===Number(state.distance)) && applyFilters(r));
  }

  function getFeat(track, surface){
    if (feat){ const key = track + "|" + surface; if (feat[key]) return {...feat[key], _src:"CSV"}; }
    return {...builtInFeat[track]?.[surface], _src:"内蔵"};
  }

  function update(){
    const arr = filtered();
    const panel = document.getElementById("panel");
    if (!state.track || !state.surface || !state.distance){ panel.style.display="none"; return; }
    panel.style.display="";
    document.getElementById("title").textContent = `${state.track}・${state.surface}・${state.distance}m`;
    document.getElementById("count").textContent = `${arr.length} 件`;
    document.getElementById("base").textContent = baseLabel(state.distance)||"—";

    const avg = (a)=> a.length? a.reduce((s,v)=>s+v,0)/a.length : NaN;
    const nums = (k)=> arr.map(x=>x[k]).filter(v=>isFinite(v));
    const passAvg=avg(nums("pass")), lastAvg=avg(nums("last3f")), cvAvg=avg(nums("cushion")), moAvg=avg(nums("moisture"));
    document.getElementById("avgPass").textContent=fmt(passAvg);
    document.getElementById("avgLast3f").textContent=fmt(lastAvg);
    document.getElementById("avgCv").textContent=fmt(cvAvg);
    document.getElementById("avgMoist").textContent=fmt(moAvg);
    let delta; if (isFinite(passAvg) && isFinite(lastAvg)){ const baseM = state.distance<=1200?600: state.distance<=1600?800:1000; delta = (lastAvg/3) - (passAvg/(baseM/200)); }
    let pace="—"; if (isFinite(delta)){ if (delta<-0.3) pace="H"; else if (delta>0.3) pace="S"; else pace="M"; }
    document.getElementById("pace").innerHTML = `<span class="tag">${pace}</span>`;

    const f = getFeat(state.track, state.surface);
    document.getElementById("featSource").textContent = f? `（${f._src}）` : "（—）";
    const chips = [];
    if (f?.turn_dir) chips.push(`回り: ${f.turn_dir}`);
    if (f?.straight_len_m) chips.push(`直線: ${f.straight_len_m}m（${f.straight_len||""}）`);
    if (f?.finish_slope) chips.push(`坂: ${f.finish_slope}${f.slope_position? " / "+f.slope_position:""}`);
    if (f?.elevation_diff_m||f?.elevation_diff) chips.push(`高低差: ${f.elevation_diff_m||f.elevation_diff}m`);
    if (f?.course_shape) chips.push(`形状: ${f.course_shape}`);
    if (f?.turf_start && f.turf_start!=="—" && f.turf_start!=="無し" && state.surface==="ダ") chips.push(`芝スタート: ${f.turf_start}m`);
    document.getElementById("featChips").innerHTML = chips.map(s=> `<span class="chip">${s}</span>`).join("");
    document.getElementById("featNotes").textContent = f?.notes || "";

    const tbody=document.querySelector("#tbl tbody"); tbody.innerHTML="";
    arr.slice(0,800).forEach(r=>{
      const tags = [];
      if (r.course_variant) tags.push("Var:"+r.course_variant);
      if (typeof r.turf_start==="boolean") tags.push(r.turf_start? "芝S":"土S");
      if (r.straight_len) tags.push("直線:"+r.straight_len);
      if (r.turn_dir) tags.push(r.turn_dir);
      if (r.course_shape) tags.push(r.course_shape);
      if (r.finish_slope) tags.push("坂:"+r.finish_slope);
      if (isFinite(r.straight_len_m)) tags.push(`直線距離:${r.straight_len_m}m`);
      if (isFinite(r.elevation_diff)) tags.push(`高低差:${r.elevation_diff}m`);
      const tr=document.createElement("tr");
      tr.innerHTML = `<td>${r.date||""}</td><td>${r.track||""}</td><td>${r.surface||""}</td><td class="right">${r.distance||""}</td><td>${baseLabel(Number(r.distance)||0)}</td><td>${r.course_variant||""}</td><td class="right">${fmt(r.pass)}</td><td class="right">${fmt(r.last3f)}</td><td class="right">${fmt(r.cushion)}</td><td class="right">${fmt(r.moisture)}</td><td>${r.going||""}</td><td>${r.course||""}</td><td>${tags.map(x=>`<span class='tag'>${x}</span>`).join(" ")}</td>`;
      tbody.appendChild(tr);
    });
  }

  // CSV import/export
  document.getElementById("a_export").onclick=()=>{
    const header=["date","track","surface","distance","pass","last3f","cushion","moisture","going","course","course_variant","turf_start","straight_len","course_shape","turn_dir","finish_slope","straight_len_m","elevation_diff"];
    const lines=[header.join(",")].concat(rows.map(r=> header.map(k=> {
      const v = r[k]; if (typeof v==="boolean") return v? "true":"false"; return v??"";
    }).join(",")));
    const blob=new Blob([lines.join("\n")],{type:"text/csv"}); const url=URL.createObjectURL(blob);
    const a=document.createElement("a"); a.href=url; a.download="keiba_rows_v11.csv"; a.click(); URL.revokeObjectURL(url);
  };
  document.getElementById("a_import").addEventListener("change", e=>{
    const f=e.target.files[0]; if(!f) return;
    const fr=new FileReader();
    fr.onload=()=>{
      try{
        const text=String(fr.result); const lines=text.split(/\r?\n/).filter(Boolean); const head=lines[0].split(",");
        const idx=k=> head.indexOf(k);
        const toNum=v=>{ const n=Number(v); return isFinite(n)?n:undefined; };
        const toBool=v=> v===undefined? undefined : (String(v).toLowerCase()==="true");
        rows = lines.slice(1).map(line=>{
          const c=line.split(",");
          return {
            date:c[idx("date")]||"", track:c[idx("track")]||"", surface:c[idx("surface")]||"",
            distance: toNum(c[idx("distance")]), pass: toNum(c[idx("pass")]), last3f: toNum(c[idx("last3f")]),
            cushion: toNum(c[idx("cushion")]), moisture: toNum(c[idx("moisture")]), going:c[idx("going")]||"", course:c[idx("course")]||"",
            course_variant: (idx("course_variant")>=0? (c[idx("course_variant")]||"") : ""),
            turf_start: (idx("turf_start")>=0? toBool(c[idx("turf_start")]) : undefined),
            straight_len: (idx("straight_len")>=0? (c[idx("straight_len")]||"") : ""),
            course_shape: (idx("course_shape")>=0? (c[idx("course_shape")]||"") : ""),
            turn_dir: (idx("turn_dir")>=0? (c[idx("turn_dir")]||"") : ""),
            finish_slope: (idx("finish_slope")>=0? (c[idx("finish_slope")]||"") : ""),
            straight_len_m: (idx("straight_len_m")>=0? toNum(c[idx("straight_len_m")]) : undefined),
            elevation_diff: (idx("elevation_diff")>=0? toNum(c[idx("elevation_diff")]) : undefined)
          };
        }).filter(r=> r.track && r.surface && r.distance);
        save(rows); renderDistances(); update(); alert("CSVを読み込みました");
      }catch(err){ alert("CSV読み込みエラー: "+err); }
      e.target.value="";
    };
    fr.readAsText(f);
  });

  // Course features CSV
  document.getElementById("feat_import").addEventListener("change", e=>{
    const f=e.target.files[0]; if(!f) return;
    const fr=new FileReader();
    fr.onload=()=>{
      try{
        const text=String(fr.result);
        const lines=text.split(/\r?\n/).filter(Boolean);
        const head=lines[0].split(",");
        const idx=k=> head.indexOf(k);
        const out={};
        lines.slice(1).forEach(line=>{
          const c=line.split(",");
          const rec={
            track: c[idx("track")], surface: c[idx("surface")],
            turn_dir: c[idx("turn_dir")],
            straight_len_m: Number(c[idx("straight_len_m")])||undefined,
            straight_len: c[idx("straight_len")],
            elevation_diff_m: Number(c[idx("elevation_diff_m")])||undefined,
            finish_slope: c[idx("finish_slope")],
            slope_position: c[idx("slope_position")],
            course_shape: c[idx("course_shape")],
            turf_start: c[idx("turf_start")],
            turf_start_note: c[idx("turf_start_note")],
            notes: c[idx("notes")]
          };
          if (rec.track && rec.surface){
            out[rec.track + "|" + rec.surface] = rec;
          }
        });
        feat = out; saveFeat(out); update();
        alert("コース特徴CSVを読み込みました（" + Object.keys(out).length + " 件）");
      }catch(err){ alert("特徴CSV読み込みエラー: "+err); }
      e.target.value="";
    };
    fr.readAsText(f);
  });

  // Sample loader: tiny dataset to verify UI
  document.getElementById("a_sample").onclick = ()=>{
    rows = [
      {date:"2025-10-01",track:"東京",surface:"芝",distance:2000,pass:58.2,last3f:34.1,cushion:8.6,moisture:13.1,going:"良",course:"A",course_variant:"A",turf_start:false,straight_len:"長い",course_shape:"大回り",turn_dir:"左回り",finish_slope:"あり",straight_len_m:526,elevation_diff:2.0},
      {date:"2025-10-01",track:"東京",surface:"ダ",distance:1600,pass:60.8,last3f:37.0,cushion:9.3,moisture:12.4,going:"良",course:"A",course_variant:"A",turf_start:true,straight_len:"普通",course_shape:"大回り",turn_dir:"左回り",finish_slope:"あり",straight_len_m:526,elevation_diff:2.0},
      {date:"2025-10-01",track:"中山",surface:"芝",distance:1800,pass:60.3,last3f:34.9,cushion:9.0,moisture:12.0,going:"良",course:"B",course_variant:"B",turf_start:false,straight_len:"普通",course_shape:"小回り",turn_dir:"右回り",finish_slope:"あり",straight_len_m:310,elevation_diff:5.3},
      {date:"2025-10-01",track:"中京",surface:"ダ",distance:1400,pass:59.8,last3f:36.9,cushion:9.2,moisture:11.7,going:"良",course:"D",course_variant:"D",turf_start:true,straight_len:"普通",course_shape:"普通",turn_dir:"左回り",finish_slope:"あり",straight_len_m:412,elevation_diff:3.5}
    ];
    save(rows); renderDistances(); update(); alert("サンプルデータを読み込みました");
  };

  // Clear & preset
  document.getElementById("a_clear").onclick = ()=>{ localStorage.removeItem(ls); rows=[]; renderDistances(); update(); alert("保存データを消去しました"); };
  document.getElementById("a_preset").onclick = ()=>{ alert("プリセットはコース特徴（内蔵）を指します。レース行はCSV/サンプルを読み込んでね。"); };

  // init
  setTimeout(()=>{
    $$("#segTrack button")[0]?.click();
    document.body.dataset.surface="turf";
    document.getElementById("surfacePill").style.display="inline-flex";
    document.getElementById("surfacePill").textContent="芝（GREEN）";
  },0);
})();
</script>
</body>
</html>
